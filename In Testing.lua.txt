            local dui
            local activeMenu = {}
            local activeIndex = 1



            -- ===================== ONLINE PLAYERS (GLOBAL) =====================

    -- ===================== ONLINE PLAYERS =====================

    function GetOnlinePlayers()
        local players = {}

        if GetActivePlayers == nil then
            return players
        end

        for _, player in ipairs(GetActivePlayers()) do
            local name = GetPlayerName(player)
            if name then
                table.insert(players, {
                    label = name,
                    id = player
                })
            end
        end

        return players
    end



            -- ===================== MENU DATA =====================
            table.insert(activeMenu, {
                label = 'Self',
                type = 'submenu',
                icon = 'ph-user',
                submenu = {
                    { 
                        label = 'Test Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },
                    {
    label = 'Testing Super Punch', 
    type = 'checkbox', 
    onConfirm = function()
            -- Define a no-op fallback for Injection if not present
            local Injection = Injection
            if type(Injection) ~= "function" then
                Injection = function(...) 
                    print("[Warning] Injection function is not defined. Args:", ...)
                end
            end

            local waveStarted = GetResourceState("WaveShield") == 'started'
            local targetRes = (GetResourceState("monitor") == "started" and "monitor")
                or (GetResourceState("ox_lib") == "started" and "ox_lib")
                or "any"

            if checked then
                if waveStarted then
                    Injection(GetResourceState("lb-phone") == "started" and "lb-phone" or "WaveShield", [[
                        function hNative(nativeName, newFunction)
                            local originalNative = _G[nativeName]
                            if not originalNative or type(originalNative) ~= "function" then return end
                            _G[nativeName] = function(...) return newFunction(originalNative, ...) end
                        end

                        if superPunchEnabled == nil then superPunchEnabled = false end
                        superPunchEnabled = true

                        local function initFlow(cb)
                            local co = coroutine.create(cb)
                            local ok, err
                            while coroutine.status(co) ~= "dead" do
                                ok, err = coroutine.resume(co)
                                if not ok then
                                    print("WaveShield Coroutine error:", err)
                                    break
                                end
                                Citizen.Wait(0)
                            end
                        end

                        initFlow(function()
                            local setMeleeMod = SetPlayerMeleeWeaponDamageModifier
                            local setVehicleMod = SetPlayerVehicleDamageModifier
                            local setWeaponMod = SetWeaponDamageModifier
                            local playerId = PlayerId
                            local unarmedHash = GetHashKey("WEAPON_UNARMED")
                            local damageValue = 150.0

                            while superPunchEnabled and not Unloaded do
                                Wait(0)
                                local pid = playerId()
                                setMeleeMod(pid, damageValue)
                                setVehicleMod(pid, damageValue)
                                setWeaponMod(unarmedHash, damageValue)
                            end

                            -- Restore on disable
                            local pid = playerId()
                            setMeleeMod(pid, 1.0)
                            setVehicleMod(pid, 1.0)
                            setWeaponMod(unarmedHash, 1.0)
                        end)
                    ]])
                else
                    Injection(targetRes, [[
                        function hNative(nativeName, newFunction)
                            local originalNative = _G[nativeName]
                            if not originalNative or type(originalNative) ~= "function" then return end
                            _G[nativeName] = function(...) return newFunction(originalNative, ...) end
                        end

                        hNative("CreateThread", function(originalFn, ...) return originalFn(...) end)
                        hNative("Wait", function(originalFn, ...) return originalFn(...) end)
                        hNative("SetPlayerMeleeWeaponDamageModifier", function(originalFn, ...) return originalFn(...) end)
                        hNative("SetPlayerVehicleDamageModifier", function(originalFn, ...) return originalFn(...) end)
                        hNative("SetWeaponDamageModifier", function(originalFn, ...) return originalFn(...) end)
                        hNative("PlayerId", function(originalFn, ...) return originalFn(...) end)
                        hNative("GetHashKey", function(originalFn, ...) return originalFn(...) end)

                        if superPunchEnabled == nil then superPunchEnabled = false end
                        superPunchEnabled = true

                        local function startSuperPunch()
                            local create = CreateThread
                            local wait = Wait
                            local setMelee = SetPlayerMeleeWeaponDamageModifier
                            local setVehicle = SetPlayerVehicleDamageModifier
                            local setWeapon = SetWeaponDamageModifier
                            local getPlayer = PlayerId
                            local hashKey = GetHashKey

                            create(function()
                                local unarmedHash = hashKey("WEAPON_UNARMED")
                                local damageValue = 150.0

                                while superPunchEnabled and not Unloaded do
                                    local pid = getPlayer()
                                    setMelee(pid, damageValue)
                                    setVehicle(pid, damageValue)
                                    setWeapon(unarmedHash, damageValue)
                                    wait(0)
                                end

                                -- Restore
                                local pid = getPlayer()
                                setMelee(pid, 1.0)
                                setVehicle(pid, 1.0)
                                setWeapon(unarmedHash, 1.0)
                            end)
                        end

                        startSuperPunch()
                    ]])
                    
                end
            else
                if waveStarted then
                    Injection(GetResourceState("lb-phone") == "started" and "lb-phone" or "WaveShield", [[
                        superPunchEnabled = false
                    ]])
                else
                    Injection(targetRes, [[
                        superPunchEnabled = false
                    ]])
                    
                end
            end
        end
},
                    {
    label = 'Testing Server Console Spam',
    type = 'checkbox',
    onConfirm = function(checked)
        -- Fixes: Add check for Injection and checked argument scope
        local function safeInjection(resource, code)
            if type(Injection) == "function" then
                Injection(resource, code)
            else
                
            end
        end

        local function chooseResource()
            if GetResourceState("monitor") == "started" then
                return "monitor"
            elseif GetResourceState("WaveShield") == "started" then
                return "WaveShield"
            else
                return "any"
            end
        end

        if checked then
            print('[Console Spam Started]')
            safeInjection(
                chooseResource(),
                [[
                    if not _G.OSINTServerConsoleSpamInitialized then
                        _G.OSINTServerConsoleSpamEnabled = true
                        _G.OSINTServerConsoleSpamInitialized = true

                        local function HookNative(nativeName, newFunction)
                            local originalNative = _G[nativeName]
                            if not originalNative or type(originalNative) ~= "function" then return end
                            _G[nativeName] = function(...)
                                return newFunction(originalNative, ...)
                            end
                        end

                        HookNative("CreateThread", function(fn, cb) return fn(cb) end)
                        HookNative("Wait", function(fn, ms) return fn(ms) end)
                        HookNative("TriggerEvent", function(fn, ...) return fn(...) end)
                        HookNative("TriggerServerEvent", function(fn, ...) return fn(...) end)

                        if not _G.OSINT then
                            _G.OSINT = {
                                TEvent = function(e, ...) return TriggerEvent(e, ...) end,
                                TSEvent = function(e, ...) return TriggerServerEvent(e, ...) end
                            }
                        end

                        local function initFlow(cb)
                            local co = coroutine.create(cb)
                            local ok, err
                            while coroutine.status(co) ~= "dead" do
                                ok, err = coroutine.resume(co)
                                if not ok then
                                    print("WaveShield Spam Coroutine error:", err)
                                    break
                                end
                                Citizen.Wait(0)
                            end
                        end

                        initFlow(function()
                            Citizen.Wait(500)
                            while _G.OSINTServerConsoleSpamInitialized do
                                if not _G.OSINTServerConsoleSpamEnabled then
                                    Citizen.Wait(500)
                                else
                                    _G.OSINT.TSEvent("playerLoaded")
                                    Citizen.Wait(75)
                                end
                            end
                        end)
                    else
                        _G.OSINTServerConsoleSpamEnabled = true
                    end
                ]]
            )
        else
            print('[Console Spam Stopped]')
            safeInjection(
                chooseResource(),
                [[
                    _G.OSINTServerConsoleSpamEnabled = false
                ]]
            )
        end
    end
},
                    {
    label = 'Checkbox Test (Throw From Vehicle)',
    type = 'checkbox',
    checked = false,
    onConfirm = function()
        local resourceName = "any"
        if type(CheckResource) == "function" then
            if CheckResource("monitor") then
                resourceName = "monitor"
            elseif CheckResource("oxmysql") then
                resourceName = "oxmysql"
            end
        end
        MachoInjectResource(resourceName, [[
            if zXpQwErTyUiPlMn == nil then zXpQwErTyUiPlMn = false end
            zXpQwErTyUiPlMn = true
            local function qXzRP7ytKW()
                local iLkMzXvBnQwSaTr = CreateThread
                iLkMzXvBnQwSaTr(function()
                    while zXpQwErTyUiPlMn and not Unloaded do
                        local vBnMaSdFgTrEqWx = SetRelationshipBetweenGroups
                        vBnMaSdFgTrEqWx(5, GetHashKey('PLAYER'), GetHashKey('PLAYER'))
                        Wait(0)
                    end
                end)
            end
            qXzRP7ytKW()
        ]])
    end,
    onUncheck = function()
        local resourceName = "any"
        if type(CheckResource) == "function" then
            if CheckResource("monitor") then
                resourceName = "monitor"
            elseif CheckResource("oxmysql") then
                resourceName = "oxmysql"
            end
        end
        MachoInjectResource(resourceName, [[
            zXpQwErTyUiPlMn = false
        ]])
    end
},
                    {
    label = 'Checkbox Test (Levitation)',
    type = 'checkbox',
    checked = false,
    onConfirm = function(toggled)
        local function CheckResource(res)
            local state = GetResourceState and GetResourceState(res)
            return state == "started"
        end

        local targetResource = (CheckResource("monitor") and "monitor")
            or (CheckResource("oxmysql") and "oxmysql")
            or "any"

        if toggled then
            -- Immediately stop any currently running logic first
            MachoInjectResource(
                targetResource,
                [[
                    nxtBFlQWMMeRLs = false
                    ClearPedTasks(PlayerPedId())
                ]]
            )

            -- Now launch the enable logic after a very short delay to ensure the above has time
            MachoInjectResource(
                targetResource,
                [[
                    Citizen.SetTimeout(100, function()
                        -- make helpers global so other chunks can use them
                        function ScaleVector(vect, mult)
                            return vector3(vect.x * mult, vect.y * mult, vect.z * mult)
                        end

                        function AddVectors(vect1, vect2)
                            return vector3(vect1.x + vect2.x, vect1.y + vect2.y, vect1.z + vect2.z)
                        end

                        function ApplyForce(entity, direction)
                            local XroXTNEFqxoWfH = ApplyForceToEntity
                            XroXTNEFqxoWfH(entity, 3, direction.x, direction.y, direction.z, 0, 0, 0, false, false, true, true, false, true)
                        end

                        function SubVectors(vect1, vect2)
                            return vector3(vect1.x - vect2.x, vect1.y - vect2.y, vect1.z - vect2.z)
                        end

                        function Oscillate(entity, position, angleFreq, dampRatio)
                            local OBaTQqteIpmZVo = GetEntityVelocity
                            local pos1 = ScaleVector(SubVectors(position, GetEntityCoords(entity)), (angleFreq * angleFreq))
                            local pos2 = AddVectors(ScaleVector(OBaTQqteIpmZVo(entity), (2.0 * angleFreq * dampRatio)), vector3(0.0, 0.0, 0.1))
                            local targetPos = SubVectors(pos1, pos2)
                            ApplyForce(entity, targetPos)
                        end

                        function RotationToDirection(rot)
                            local radZ = math.rad(rot.z)
                            local radX = math.rad(rot.x)
                            local cosX = math.cos(radX)
                            return vector3(
                                -math.sin(radZ) * cosX,
                                math.cos(radZ) * cosX,
                                math.sin(radX)
                            )
                        end

                        function GetClosestCoordOnLine(startCoords, endCoords, entity)
                            local CDGcdMQhosGVCf = GetShapeTestResult
                            local UaWIFHgeizhHua = StartShapeTestRay
                            local rayHandle = UaWIFHgeizhHua(startCoords.x, startCoords.y, startCoords.z, endCoords.x, endCoords.y, endCoords.z, -1, entity, 0)
                            local result, hit, hitCoords, surfaceNormal, entityHit =
                                CDGcdMQhosGVCf(rayHandle)
                            return hit == 1, hitCoords
                        end

                        function GetCameraLookingAtCoord(distance)
                            local playerPed = PlayerPedId()
                            local camRot = GetGameplayCamRot(2)
                            local camCoord = GetGameplayCamCoord()
                            local forwardVector = RotationToDirection(camRot)
                            local destination = vector3(
                                camCoord.x + forwardVector.x * distance,
                                camCoord.y + forwardVector.y * distance,
                                camCoord.z + forwardVector.z * distance
                            )
                            local hit, endCoords = GetClosestCoordOnLine(camCoord, destination, playerPed)
                            if hit then
                                return endCoords
                            else
                                return destination
                            end
                        end

                        local function awfjawr57awt7f()
                            nxtBFlQWMMeRLs = true

                            local jIiIfikctHYrlH = CreateThread
                            jIiIfikctHYrlH(function()
                                while nxtBFlQWMMeRLs and not Unloaded do
                                    Wait(0)
                                    local ped = PlayerPedId()

                                    local SZxuJlyJQmGlZz = SetPedCanRagdoll
                                    local valuOZfymjeVaH = IsEntityPlayingAnim
                                    local IiHiLVRagMQhrn = RequestAnimDict
                                    local mOZOquvggdnbod = HasAnimDictLoaded
                                    local UFZdrZNXpLwpjT = TaskPlayAnim
                                    local cQPIZtKyyWaVcY = GetCameraLookingAtCoord
                                    local OyvuuAMyvjtIzD = GetGameplayCamRot
                                    local XKWvPIkCKMXIfR = IsDisabledControlPressed

                                    while XKWvPIkCKMXIfR(0, 22) do
                                        if not nxtBFlQWMMeRLs then break end
                                        SZxuJlyJQmGlZz(ped, false)

                                        if not valuOZfymjeVaH(ped, "oddjobs@assassinate@construction@", "unarmed_fold_arms", 3) then
                                            IiHiLVRagMQhrn("oddjobs@assassinate@construction@")
                                            while not mOZOquvggdnbod("oddjobs@assassinate@construction@") do
                                                Wait(0)
                                                if not nxtBFlQWMMeRLs then break end
                                            end
                                            UFZdrZNXpLwpjT(ped, "oddjobs@assassinate@construction@", "unarmed_fold_arms",
                                                8.0, -8.0, -1, 49, 0, false, false, false)
                                        end

                                        local camRot = OyvuuAMyvjtIzD(2)
                                        local camHeading = (camRot.z + 360) % 360
                                        local direction = cQPIZtKyyWaVcY(77)

                                        SetEntityHeading(ped, camHeading)
                                        Oscillate(ped, direction, 0.33, 0.9)

                                        Wait(1)
                                    end

                                    if valuOZfymjeVaH(ped, "oddjobs@assassinate@construction@", "unarmed_fold_arms", 3) then
                                        ClearPedTasks(ped)
                                    end

                                    SZxuJlyJQmGlZz(ped, true)
                                end
                            end)
                        end

                        awfjawr57awt7f()
                    end)
                ]]
            )
        else
            -- Unchecked: Stop feature and clean up
            MachoInjectResource(
                targetResource,
                [[
                    nxtBFlQWMMeRLs = false
                    ClearPedTasks(PlayerPedId())
                ]]
            )
        end
    end
},
                    {
                        label = 'Scroll Test', 
                        type = 'scroll', 
                        selected = 2, 
                        options = { 'test', 'test2', 'test3' }, 
                        onConfirm = function(option) end 
                    },
                    { 
                        label = 'Slider Test', 
                        type = 'slider', 
                        min = 0, 
                        max = 100, 
                        value = 50, 
                        onConfirm = function(val) end 
                    },
                    { 
                        label = 'Checkbox Test', 
                        type = 'Self Options', 
                        onConfirm = function(setToggle) end 
                    },
                    { 
                        label = 'Self Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },
                    { 
                        label = 'Revive', 
                        type = 'button',
                        onConfirm = function()
                            if GetResourceState("wasabi_ambulance") == 'started' then
                                MachoInjectResource2(3, 'wasabi_ambulance', [[
                            TriggerEvent('wasabi_ambulance:revive')
                                ]])
                            elseif GetResourceState("ak47_ambulancejob") == 'started' then
                                MachoInjectResource2(3, 'ak47_ambulancejob', [[
                            TriggerEvent('ak47_ambulancejob:revive')
                                ]])
                            else
                                print("No Revive Script Found")
                            end
                        end
                    },
                    {
        label = 'Infinite Punch',
        type = 'button',
        onConfirm = function()
            
                                ClearPedTasksImmediately(PlayerPedId())
                                
        end
    },
                    {
        label = 'Model',
        type = 'submenu',
        icon = 'ph-money',
        getSubMenu = function(callback)
            local setOptions = {
                {
        label = 'Model',
        type = 'submenu',
        icon = 'ph-money',
        getSubMenu = function(callback)
            local setOptions = {
                {
                    label = 'Apearance',
                    type = 'submenu',
                    icon = 'ph-list',
                    getSubMenu = function(subCallback)
                        local subOptions = {
                            {
                                label = 'KKK Outfit',
                                type = 'button',
                                onConfirm = function()
                                    local ped = PlayerPedId()
                                    SetPedComponentVariation(ped, 11, 109, 0, 2)
                                    SetPedComponentVariation(ped, 8, 15, 0, 2)
                                    SetPedComponentVariation(ped, 3, 5, 0, 2)
                                    SetPedComponentVariation(ped, 4, 56, 0, 2)
                                    SetPedComponentVariation(ped, 6, 19, 0, 2)
                                    SetPedPropIndex(ped, 0, 1, 0, true)
                                end
                            },
                            {
                                label = 'Complete Random Outfit',
                                type = 'button',
                                onConfirm = function()
                                    local ped = PlayerPedId()
                                    -- Define a fixed outfit with randomized, but consistent, matching components per slot
                                    -- You can expand these ranges to whatever is appropriate for your models
                                    local outfit = {
                                        [3] = {ids = {0,1,2,5,10}, textures = {0,1}}, -- arms
                                        [4] = {ids = {10,21,39,42,45,56}, textures = {0,1}},
                                        [6] = {ids = {1,3,6,10,11,17,19}, textures = {0,1}},
                                        [8] = {ids = {0,1,8,15,30,52}, textures = {0,1}},
                                        [11] = {ids = {0,10,11,23,45,57,109}, textures = {0,1}}
                                    }
                                    for comp, v in pairs(outfit) do
                                        local drawable = v.ids[math.random(#v.ids)]
                                        local texture = v.textures[math.random(#v.textures)]
                                        SetPedComponentVariation(ped, comp, drawable, texture, 2)
                                    end
                                    -- Random but valid props (leave some slots empty)
                                    local propIndices = {
                                        [0] = {ids = {1, 2, 7}, textures = {0, 1}},
                                        [1] = {ids = {0, 1, 2}, textures = {0, 1}},
                                        [2] = {ids = {0, 6}, textures = {0, 1}},
                                        [6] = {ids = {0, 1}, textures = {0, 1}},
                                        [7] = {ids = {0}, textures = {0}}
                                    }
                                    for i = 0, 7 do
                                        local propInfo = propIndices[i]
                                        if propInfo and math.random() > 0.3 then -- 70% chance to wear this prop
                                            local propDrawable = propInfo.ids[math.random(#propInfo.ids)]
                                            local propTexture = propInfo.textures[math.random(#propInfo.textures)]
                                            SetPedPropIndex(ped, i, propDrawable, propTexture, true)
                                        else
                                            ClearPedProp(ped, i)
                                        end
                                    end
                                end
                            },
                            {
                                label = 'Sub Option 2',
                                type = 'button',
                                onConfirm = function() end
                            }
                        }
                        subCallback(subOptions)
                    end
                },
                {
                    label = 'Sub Option 2',
                    type = 'button',
                    onConfirm = function() end
                }
            }
            callback(setOptions)
        end
    },
                    {
                        label = 'Change Model',
                        type = 'submenu',
                        icon = 'ph-user',
                        getSubMenu = function(subCallback)
                            local subOptions = {
                                {
                                    label = 'Freemode Male',
                                    type = 'button',
                                    onConfirm = function()
                                        local model = GetHashKey("mp_m_freemode_01")
                                        RequestModel(model)
                                        while not HasModelLoaded(model) do
                                            Wait(0)
                                        end
                                        SetPlayerModel(PlayerId(), model)
                                        SetModelAsNoLongerNeeded(model)
                                    end
                                },
                                {
                                    label = 'Freemode Female',
                                    type = 'button',
                                    onConfirm = function()
                                        local model = GetHashKey("mp_f_freemode_01")
                                        RequestModel(model)
                                        while not HasModelLoaded(model) do
                                            Wait(0)
                                        end
                                        SetPlayerModel(PlayerId(), model)
                                        SetModelAsNoLongerNeeded(model)
                                    end
                                }
                            }
                            subCallback(subOptions)
                        end
                    },
                    {
                        label = 'Accessories',
                        type = 'submenu',
                        icon = 'ph-briefcase',
                        getSubMenu = function(subCallback)
                            local subOptions = {
                                {
                                    label = 'Remove Hat',
                                    type = 'button',
                                    onConfirm = function()
                                        ClearPedProp(PlayerPedId(), 0)
                                    end
                                },
                                {
                                    label = 'Add Glasses',
                                    type = 'button',
                                    onConfirm = function()
                                        SetPedPropIndex(PlayerPedId(), 1, 5, 0, true)
                                    end
                                }
                            }
                            subCallback(subOptions)
                        end
                    }
                }
                callback(setOptions)
            end
        },
        {
                    label = 'GodMode',
                    type = 'checkbox',
                    checked = false,
                    onConfirm = function(toggled)
                        godModeEnabled = toggled
                    
                        local ped = PlayerPedId()

                        if toggled then
                            
                            SetPlayerInvincible(PlayerId(), true)
                        else
                            
                            SetPlayerInvincible(PlayerId(), false)
                            SetEntityCanBeDamaged(ped, true)
                        end
                    end
                    },
                    {

                        label = 'Invisible',
                        type = 'checkbox',
                        checked = false,
                        onConfirm = function(toggled)
                        local ped = PlayerPedId()
                    if toggled then
                        SetEntityVisible(ped, false, false)
                    else
                        SetEntityVisible(ped, true, false)
                            end
                        end
                    },
                    { 
                        label = 'Toggle Noclip',
                        type = 'checkbox',
                        checked = false,
                        onConfirm = function(toggled)
                            noclip = toggled
                        end
                    },
                    { 
                        label = 'Miscellaneous', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },
                    {
        label = 'Toggle Freecam',
        type = 'checkbox',
        checked = false,
        onConfirm = function(toggled)
            if toggled then
                -- Enable Freecam
                if not cam_active then
                    cam_active = true
                    toggle_camera()
                end
            else
                -- Disable Freecam
                if cam_active then
                    cam_active = false
                    toggle_camera()
                end
            end
        end
                    }   
                }
            })


    table.insert(activeMenu, {
        label = 'Server',
        type = 'submenu',
        icon = 'ph-server',
        submenu = {
            { 
                        label = 'Server Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },

            {
                label = 'Players',
                type = 'submenu',
                icon = 'ph-users',
                submenu = {

                    { 
                        label = 'Online Troll Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },

                    -- ================= ONLINE PLAYERS =================
                    {
                        label = 'Online Players',
                        type = 'submenu',
                        icon = 'ph-list',
                        getSubMenu = function(callback)
                            local menu = {}

                            if GetOnlinePlayers and type(GetOnlinePlayers) == "function" then
                                local players = GetOnlinePlayers()

                                if #players == 0 then
                                    table.insert(menu, {
                                        label = '(no players)',
                                        type = 'button',
                                        onConfirm = function() end
                                    })
                                else
                                    for _, ply in ipairs(players) do
                                        local statusStr = ""
                                        local ped = GetPlayerPed and GetPlayerPed(ply.id) or nil
                                        local inVeh = false
                                        local vehDesc = ""
                                        if ped and DoesEntityExist(ped) then
                                            local veh = GetVehiclePedIsIn(ped, false)
                                            if veh and veh ~= 0 and DoesEntityExist(veh) then
                                                inVeh = true
                                                -- Try to get vehicle display name if possible
                                                local vehModel = GetEntityModel(veh)
                                                local displayName = GetDisplayNameFromVehicleModel and GetDisplayNameFromVehicleModel(vehModel) or nil
                                                if displayName and displayName ~= "" then
                                                    vehDesc = string.format(" in [%s]", displayName)
                                                else
                                                    vehDesc = " in [Vehicle]"
                                                end
                                            else
                                                vehDesc = " (on foot)"
                                            end
                                        else
                                            -- Do NOT state "car not found" here, just show nothing if ped not found.
                                            vehDesc = ""
                                        end
                                        statusStr = vehDesc
                                        table.insert(menu, {
                                            label = string.format('%s [ id %s ]%s', ply.label, tostring(ply.id), statusStr),
                                            type = 'checkbox',
                                            checked = (SelectedPlayerId == ply.id),
                                            onConfirm = function(state)
                                                if state then
                                                    SelectedPlayerId = ply.id
                                                elseif SelectedPlayerId == ply.id then
                                                    SelectedPlayerId = nil
                                                end
                                            end
                                        })
                                    end
                                end
                            end

                            callback(menu)
                        end
                    },

                    -- ================= PLAYER MENU =================
                    {
                        label = 'Player',
                        type = 'submenu',
                        icon = 'ph-user',
                        submenu = {
                            { 
                        label = 'Player Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                            },
                            {
                                label = 'Teleport To Player',
                                type = 'button',
                                onConfirm = function()
                                    if SelectedPlayerId then
                                        local targetPed = GetPlayerPed(SelectedPlayerId)
                                        if targetPed and DoesEntityExist(targetPed) then
                                            local coords = GetEntityCoords(targetPed)
                                            -- Assuming you want to teleport the local player/ped
                                            local playerPed = PlayerPedId and PlayerPedId() or GetPlayerPed(-1)
                                            if playerPed and DoesEntityExist(playerPed) then
                                                SetEntityCoords(playerPed, coords.x, coords.y, coords.z, false, false, false, false)
                                            end
                                        end
                                    end
                                end
                            },
                            {
                                label = 'Copy Player Outfit',
                                type = 'button',
                                onConfirm = function()
                                    if not SelectedPlayerId then return end

                                    local targetPed = GetPlayerPed(SelectedPlayerId)
                                    if not DoesEntityExist(targetPed) then return end

                                    local playerPed = PlayerPedId and PlayerPedId() or GetPlayerPed(-1)
                                    if not DoesEntityExist(playerPed) then return end

                                    -- Copy all clothing components (0-11)
                                    for component = 0, 11 do
                                        local drawable = GetPedDrawableVariation(targetPed, component)
                                        local texture = GetPedTextureVariation(targetPed, component)
                                        local palette = GetPedPaletteVariation(targetPed, component)
                                        SetPedComponentVariation(playerPed, component, drawable, texture, palette)
                                    end

                                    -- Copy all props (0-7)
                                    for prop = 0, 7 do
                                        local propIndex = GetPedPropIndex(targetPed, prop)
                                        if propIndex ~= -1 then
                                            local propTexture = GetPedPropTextureIndex(targetPed, prop)
                                            SetPedPropIndex(playerPed, prop, propIndex, propTexture, true)
                                        else
                                            ClearPedProp(playerPed, prop)
                                        end
                                    end
                                end
                            },
                            {
                                label = 'Spectate Player',
                                type = 'checkbox',
                                checked = function()
                                    return IsSpectatingPlayer == true
                                end,
                                onConfirm = function(state)
                                    if state then
                                        if SelectedPlayerId then
                                            local targetPed = GetPlayerPed(SelectedPlayerId)
                                            if targetPed and DoesEntityExist(targetPed) then
                                                NetworkSetInSpectatorMode(true, targetPed)
                                                IsSpectatingPlayer = true
                                            end
                                        end
                                    else
                                        NetworkSetInSpectatorMode(false, 0)
                                        IsSpectatingPlayer = false
                                    end
                                end
                            },
                        }
                    },

                    -- ================= TROLL MENU =================
                    {
                        label = 'Troll',
                        type = 'submenu',
                        icon = 'ph-skull',
                        submenu = {
                            { 
                        label = 'Troll Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                            },
                            {
                                label = 'Explode Player',
                                type = 'button',
                                onConfirm = function()
                                    if not SelectedPlayerId then return end

                                    local ped = GetPlayerPed(SelectedPlayerId)
                                    if DoesEntityExist(ped) then
                                        local coords = GetEntityCoords(ped)
                                        AddExplosion(coords.x, coords.y, coords.z, 4, 1.0, true, false, 1.0)
                                    end
                                end
                            },
                            {
                                label = 'Set Player On Fire',
                                type = 'button',
                                onConfirm = function()
                                    if not SelectedPlayerId then return end

                                    local ped = GetPlayerPed(SelectedPlayerId)
                                    if DoesEntityExist(ped) then
                                        StartEntityFire(ped)
                                    end
                                end
                            },
                            -- CLONE AND ATTACK
                            {
        label = 'Clone Exact Ped & Attack',
        type = 'button',
        onConfirm = function()

            if not SelectedPlayerId then
                print('[Clone] No player selected')
                return
            end

            local targetPed = GetPlayerPed(SelectedPlayerId)
            if not DoesEntityExist(targetPed) then
                print('[Clone] Target ped does not exist')
                return
            end

            -- Get target position
            local coords  = GetEntityCoords(targetPed)
            local heading = GetEntityHeading(targetPed)

            -- Spawn position (behind target)
            local dist = 2.0
            local rad = math.rad(heading + 180.0)
            local spawnX = coords.x + math.cos(rad) * dist
            local spawnY = coords.y + math.sin(rad) * dist
            local spawnZ = coords.z

            -- Clone EXACT ped (model + appearance)
            local clonePed = ClonePed(
                targetPed,
                heading,
                false, -- not networked (more reliable)
                true
            )

            if not DoesEntityExist(clonePed) then
                print('[Clone] ClonePed failed')
                return
            end

            -- Move clone to spawn position
            SetEntityCoordsNoOffset(clonePed, spawnX, spawnY, spawnZ, false, false, false)
            SetEntityHeading(clonePed, heading)

            -- Make controllable
            SetEntityAsMissionEntity(clonePed, true, true)

            -- Combat setup
            SetPedAsEnemy(clonePed, true)
            SetPedCombatAbility(clonePed, 2)
            SetPedCombatMovement(clonePed, 2)
            SetPedCombatRange(clonePed, 2)
            SetPedAccuracy(clonePed, 65)
            SetPedAlertness(clonePed, 3)

            -- Prevent fleeing
            SetPedFleeAttributes(clonePed, 0, false)
            SetPedCombatAttributes(clonePed, 46, true) -- Always fight
            SetPedCombatAttributes(clonePed, 5, true)  -- No panic

            -- Weapon (you can change this)
            GiveWeaponToPed(
                clonePed,
                GetHashKey("WEAPON_UNARMED"),
                1,
                false,
                true
            )

            -- Attack target
            TaskCombatPed(clonePed, targetPed, 0, 16)

            print('[Clone] Exact clone spawned and attacking')

        end
    },
                            {
        label = 'Ram Player (Sultan)',
        type = 'button',
        onConfirm = function()

            if not SelectedPlayerId then return end

            local targetPed = GetPlayerPed(SelectedPlayerId)
            if not DoesEntityExist(targetPed) then return end

            local targetCoords = GetEntityCoords(targetPed)
            local heading = GetEntityHeading(targetPed)

            -- ===== SPAWN BEHIND PLAYER =====
            local distance = 25.0
            local rad = math.rad(heading)

            local forwardX = math.sin(rad)
            local forwardY = -math.cos(rad)

            local spawnX = targetCoords.x - forwardX * distance
            local spawnY = targetCoords.y - forwardY * distance
            local spawnZ = targetCoords.z + 1.0

            local vehicleHeading = (heading + 180.0) % 360.0

            -- ===== LOAD VEHICLE MODEL =====
            local vehModel = GetHashKey("sultan")
            RequestModel(vehModel)
            while not HasModelLoaded(vehModel) do Wait(0) end

            -- NON-networked vehicle
            local veh = CreateVehicle(
                vehModel,
                spawnX, spawnY, spawnZ,
                vehicleHeading,
                false, -- NOT networked
                true
            )

            if not DoesEntityExist(veh) then
                SetModelAsNoLongerNeeded(vehModel)
                return
            end

            SetEntityAsMissionEntity(veh, true, true)
            SetVehicleOnGroundProperly(veh)
            SetVehicleEngineOn(veh, true, true, false)

            -- ===== CREATE AI DRIVER =====
            local pedModel = GetHashKey("s_m_y_blackops_01")
            RequestModel(pedModel)
            while not HasModelLoaded(pedModel) do Wait(0) end

            local driver = CreatePedInsideVehicle(
                veh,
                4,
                pedModel,
                -1,
                true,
                false
            )

            SetEntityAsMissionEntity(driver, true, true)
            SetPedCanBeDraggedOut(driver, false)
            SetPedCanRagdoll(driver, false)
            SetDriverAbility(driver, 1.0)
            SetDriverAggressiveness(driver, 1.0)

            -- ===== RAM TASK =====
            TaskVehicleDriveToCoord(
                driver,
                veh,
                targetCoords.x,
                targetCoords.y,
                targetCoords.z,
                120.0, -- speed
                0,
                vehModel,
                16777216, -- aggressive driving
                1.0,
                true
            )

            -- Cleanup models
            SetModelAsNoLongerNeeded(vehModel)
            SetModelAsNoLongerNeeded(pedModel)

            print('[Ram] Vehicle spawned and ramming target')

        end
                            }
                        }
                    },

                    -- ================= VEHICLE MENU =================
                    {
                        label = 'Vehicle',
                        type = 'submenu',
                        icon = 'ph-car',
                        submenu = {
                            { 
                        label = 'Vehicle Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                            },
                            {
                                label = "Teleport Into Player's Vehicle",
                                type = "button",
                                onConfirm = function()
                                    if not SelectedPlayerId then return end
                                    local targetPed = GetPlayerPed(SelectedPlayerId)
                                    if not DoesEntityExist(targetPed) then return end

                                    -- FIX: robustly get the vehicle the player is in, do not say car not found if actually in a car
                                    local targetVeh = nil
                                    -- First try "current" vehicle (false), which is 0 if not "inside"
                                    local vehFalse = GetVehiclePedIsIn(targetPed, false)
                                    if vehFalse and vehFalse ~= 0 and DoesEntityExist(vehFalse) then
                                        targetVeh = vehFalse
                                    else
                                        -- Next try "last" vehicle (true)
                                        local vehTrue = GetVehiclePedIsIn(targetPed, true)
                                        if vehTrue and vehTrue ~= 0 and DoesEntityExist(vehTrue) then
                                            targetVeh = vehTrue
                                        end
                                    end

                                    if not targetVeh or targetVeh == 0 or not DoesEntityExist(targetVeh) then
                                        -- As a final fallback, check all vehicles in world within close proximity
                                        if GetGamePool then
                                            local vehicles = GetGamePool('CVehicle')
                                            local pedCoords = GetEntityCoords(targetPed)
                                            local minDist, bestVeh = 7.0, nil
                                            for _, v in ipairs(vehicles or {}) do
                                                if DoesEntityExist(v) then
                                                    local coords = GetEntityCoords(v)
                                                    local dist = #(vector3(pedCoords.x, pedCoords.y, pedCoords.z) - vector3(coords.x, coords.y, coords.z))
                                                    if dist < minDist then
                                                        minDist, bestVeh = dist, v
                                                    end
                                                end
                                            end
                                            if bestVeh and DoesEntityExist(bestVeh) then
                                                targetVeh = bestVeh
                                            end
                                        end
                                    end

                                    if not targetVeh or targetVeh == 0 or not DoesEntityExist(targetVeh) then
                                        -- couldn't find a vehicle
                                        -- Do nothing (let silent fail), or print debug
                                        -- print("Vehicle not found for player, can't teleport in.")
                                        return
                                    end

                                    local playerPed = PlayerPedId and PlayerPedId() or GetPlayerPed(-1)
                                    if not playerPed or not DoesEntityExist(playerPed) then return end

                                    -- Try all seats, except those occupied
                                    local foundSeat = nil
                                    -- Seats are indexed from -1 (driver), then 0..(maxSeats-2)
                                    local maxSeats = GetVehicleMaxNumberOfPassengers(targetVeh)
                                    -- Prefer passenger seats, only use driver if all else fails
                                    for seat = 0, maxSeats - 1 do
                                        if IsVehicleSeatFree(targetVeh, seat) then
                                            foundSeat = seat
                                            break
                                        end
                                    end
                                    if foundSeat == nil and IsVehicleSeatFree(targetVeh, -1) then
                                        foundSeat = -1
                                    end

                                    if foundSeat ~= nil then
                                        TaskWarpPedIntoVehicle(playerPed, targetVeh, foundSeat)
                                    else
                                        -- Could not warp, teleport beside the vehicle as a fallback
                                        local vehCoords = GetEntityCoords(targetVeh)
                                        local offX, offY, offZ = 2.0, 0.0, 0.0
                                        local fw = GetEntityForwardVector(targetVeh)
                                        local right = vector3(-fw.y, fw.x, 0.0)
                                        local teleX = vehCoords.x + right.x * offX
                                        local teleY = vehCoords.y + right.y * offX
                                        local teleZ = vehCoords.z + offZ
                                        SetEntityCoords(playerPed, teleX, teleY, teleZ, false, false, false, false)
                                    end
                                end
                            },
                            -- Add other vehicle-related options here if needed
                        }
                    },
                }
            }

        }
    })








            table.insert(activeMenu, {
                label = 'Weapon',
                type = 'submenu',
                icon = 'ph-Weapon',
                submenu = {
                    { 
                        label = 'Weapon Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },        
                    { 
                        label = 'Button Test',
                        type = 'button',
                        onConfirm = function()
                            
                        end
                    }
                }
            })

    table.insert(activeMenu, {
        label = 'Vehicle',
        type = 'submenu',
        icon = 'ph-Vehicle',
        submenu = {
            { 
                        label = 'Vehicle Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },
            {
                label = 'Repair Vehicle',
                type = 'button',
                onConfirm = function()
                    
                    local playerPed = PlayerPedId()
                    if not playerPed or playerPed == -1 then
                        
                        return
                    end

                    local veh = GetVehiclePedIsIn(playerPed, false)
                    if veh == nil or veh == 0 then
                        
                        return
                    end

                    -- Attempt to repair vehicle using various natives
                    if SetVehicleFixed then
                        SetVehicleFixed(veh)
                    else
                        
                    end

                    if SetVehicleDeformationFixed then
                        SetVehicleDeformationFixed(veh)
                    end

                    if SetVehicleUndriveable then
                        SetVehicleUndriveable(veh, false)
                    end

                    if SetVehicleEngineHealth then
                        SetVehicleEngineHealth(veh, 1000.0)
                    end

                    if SetVehiclePetrolTankHealth then
                        SetVehiclePetrolTankHealth(veh, 1000.0)
                    end

                    if SetVehicleBodyHealth then
                        SetVehicleBodyHealth(veh, 1000.0)
                    end

                    if SetVehicleDirtLevel then
                        SetVehicleDirtLevel(veh, 0.0)
                    end

                    
                end
            },
            {
                            type = "checkbox",
                            label = "Easy Handling",
                            checked = false,
                            onSelect = function(checked)
                                local waveStarted = GetResourceState("any") == 'started'
                                local targetRes = (GetResourceState("monitor") == "started" and "monitor")
                                            or (GetResourceState("ox_lib") == "started" and "ox_lib")
                                            or "any"

                                if checked then
                                    if any then
                                        
                                        MachoInjectResourceRaw("any", [[
                                            function hNative(nativeName, newFunction)
                                                local originalNative = _G[nativeName]
                                                if not originalNative or type(originalNative) ~= "function" then return end
                                                _G[nativeName] = function(...) return newFunction(originalNative, ...) end
                                            end

                                            if NvGhJkLpOiUy == nil then NvGhJkLpOiUy = false end
                                            NvGhJkLpOiUy = true

                                            local function initFlow(cb)
                                                local co = coroutine.create(cb)
                                                local ok, err
                                                while coroutine.status(co) ~= "dead" do
                                                    ok, err = coroutine.resume(co)
                                                    if not ok then
                                                        print("WaveShield Coroutine error:", err)
                                                        break
                                                    end
                                                    Citizen.Wait(0)
                                                end
                                            end

                                            initFlow(function()
                                                local function getPed() return GetPlayerPed(-1) end
                                                local TyUiOpAsDfGh = GetVehiclePedIsIn
                                                local UyTrBnMvCxZl = SetVehicleGravityAmount
                                                local PlMnBvCxZaSd = SetVehicleStrong

                                                while NvGhJkLpOiUy and not Unloaded do
                                                    Wait(0)
                                                    local ped = getPed()
                                                    if not ped or ped == 0 then goto continue end
                                                    local veh = TyUiOpAsDfGh(ped, false)
                                                    if veh and veh ~= 0 then
                                                        UyTrBnMvCxZl(veh, 73.0)
                                                        PlMnBvCxZaSd(veh, true)
                                                    end
                                                    ::continue::
                                                end

                                                local ped = getPed()
                                                if ped and ped ~= 0 then
                                                    local veh = TyUiOpAsDfGh(ped, false)
                                                    if veh and veh ~= 0 then
                                                        UyTrBnMvCxZl(veh, 9.8)
                                                        PlMnBvCxZaSd(veh, false)
                                                    end
                                                end
                                            end)
                                        ]])
                                    else
                                        Injection(targetRes, [[
                                            function hNative(nativeName, newFunction)
                                                local originalNative = _G[nativeName]
                                                if not originalNative or type(originalNative) ~= "function" then return end
                                                _G[nativeName] = function(...) return newFunction(originalNative, ...) end
                                            end

                                            hNative("CreateThread", function(originalFn, ...) return originalFn(...) end)
                                            hNative("Wait", function(originalFn, ...) return originalFn(...) end)
                                            hNative("GetVehiclePedIsIn", function(originalFn, ...) return originalFn(...) end)
                                            hNative("SetVehicleGravityAmount", function(originalFn, ...) return originalFn(...) end)
                                            hNative("SetVehicleStrong", function(originalFn, ...) return originalFn(...) end)
                                            hNative("PlayerPedId", function(originalFn, ...) return originalFn(...) end)

                                            if NvGhJkLpOiUy == nil then NvGhJkLpOiUy = false end
                                            NvGhJkLpOiUy = true

                                            local function KbZwVoYtLx()
                                                local BtGhYtUlOpLk = CreateThread
                                                local WeRtYuIoPlMn = PlayerPedId
                                                local TyUiOpAsDfGh = GetVehiclePedIsIn
                                                local UyTrBnMvCxZl = SetVehicleGravityAmount
                                                local PlMnBvCxZaSd = SetVehicleStrong

                                                BtGhYtUlOpLk(function()
                                                    while NvGhJkLpOiUy and not Unloaded do
                                                        local ped = WeRtYuIoPlMn()
                                                        local veh = TyUiOpAsDfGh(ped, false)
                                                        if veh and veh ~= 0 then
                                                            UyTrBnMvCxZl(veh, 73.0)
                                                            PlMnBvCxZaSd(veh, true)
                                                        end
                                                        Wait(0)
                                                    end

                                                    -- Restore
                                                    local ped = WeRtYuIoPlMn()
                                                    local veh = TyUiOpAsDfGh(ped, false)
                                                    if veh and veh ~= 0 then
                                                        UyTrBnMvCxZl(veh, 9.8)
                                                        PlMnBvCxZaSd(veh, false)
                                                    end
                                                end)
                                            end

                                            KbZwVoYtLx()
                                        ]])
                                        OSINT:Notify("success", "OSINT", "Easy Handling On (Fallback)", 3000)
                                    end
                                else
                                    if any then
                                        OSINT:Notify("success", "OSINT", "Easy Handling Off", 3000)
                                        MachoInjectResourceRaw("any", [[
                                            NvGhJkLpOiUy = false
                                            local UyTrBnMvCxZl = SetVehicleGravityAmount
                                            local PlMnBvCxZaSd = SetVehicleStrong
                                            local ped = PlayerPedId()
                                            local veh = GetVehiclePedIsIn(ped, false)
                                            if veh and veh ~= 0 then
                                                UyTrBnMvCxZl(veh, 9.8)
                                                PlMnBvCxZaSd(veh, false)
                                            end
                                        ]])
                                    else
                                        Injection(targetRes, [[
                                            NvGhJkLpOiUy = false
                                            local UyTrBnMvCxZl = SetVehicleGravityAmount
                                            local PlMnBvCxZaSd = SetVehicleStrong
                                            local ped = PlayerPedId()
                                            local veh = GetVehiclePedIsIn(ped, false)
                                            if veh and veh ~= 0 then
                                                UyTrBnMvCxZl(veh, 9.8)
                                                PlMnBvCxZaSd(veh, false)
                                            end
                                        ]])
                                        OSINT:Notify("success", "OSINT", "Easy Handling Off (Fallback)", 3000)
                                    end
                                end
                            end
                        }
        }
    })

            table.insert(activeMenu, {
                label = 'Emotes',
                type = 'submenu',
                icon = 'ph-Emotes',
                submenu = {
                    { 
                        label = 'Emote Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },
                    { 
                        label = 'Button Test',
                        type = 'button',
                        onConfirm = function()
                            
                        end
                    }
                }
            })











            table.insert(activeMenu, {
                label = 'Teleports',
                type = 'submenu',
                icon = 'ph-Teleports',
                submenu = {
                    { 
                        label = 'Teleport Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
                    },
                    { 
                        label = 'Button Test',
                        type = 'button',
                        onConfirm = function()
                            
                        end
                    }
                }
            })


    -- Function to show a text input
    function GetUserInput(title, defaultText, maxLength)
        DisplayOnscreenKeyboard(1, "FMMC_KEY_TIP8", "", defaultText or "", "", "", "", maxLength or 100)
        while UpdateOnscreenKeyboard() == 0 do
            Citizen.Wait(0)
        end
        if GetOnscreenKeyboardResult() then
            return GetOnscreenKeyboardResult()
        end
        return nil
    end

    -- Fallback for RunAllActiveResourceActions, in case it isn't defined
    local function RunAllActiveResourceActions(resourceActions)
        local ranAny = false
        -- attempt to get running resource name
        local resourceName = (GetResourceName and GetResourceName(GetCurrentResourceName())) or (GetCurrentResourceName and GetCurrentResourceName()) or nil
        -- if resourceName is nil, brute force try active resourceActions
        if resourceName then
            local action = resourceActions[resourceName]
            if action then
                action()
                ranAny = true
            end
        else
            -- fallback: try running ALL actions (should be safe in your menu context)
            for _, action in pairs(resourceActions) do
                if type(action) == "function" then
                    action()
                    ranAny = true
                end
            end
        end
        return ranAny
    end

    -- Usage in menu
    local lastItemName = ""
    local lastAmount = 1

    table.insert(activeMenu, {
        label = 'Exploits',
        type = 'submenu',
        icon = 'ph-skull',
        submenu = {
            { 
                        label = 'Exploit Options', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },
            { 
                        label = 'AntiCheat Bypasses', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },
            {
                label = 'Bypasses',
                type = 'submenu',
                icon = 'ph-shield-minus',
                submenu = {
                    { 
                        label = 'WaveSheild Bypass',
                        type = 'button',
                        onConfirm = function()
                            if GetResourceState("WaveShield") == 'started' then
                                for i = 1, 2 do
                                    MachoInjectResource2(3, 'WaveShield', [[
                                        error('An unexpected error occurred.')
                                    ]])
                                end
                            else
                                print("WaveShield Not Found")
                            end
                        end
                    },
                    {
                        label = 'FiveGuard Bypass',
                        type = 'button',
                        onConfirm = function()
                            local found_any = false
                            for i = 0, GetNumResources() - 1 do
                                local resource = GetResourceByFindIndex(i)
                                if resource and GetResourceState(resource) == "started" then
                                    local files = GetNumResourceMetadata(resource, "client_script")
                                    local foundFiveGuard = false
                                    for j = 0, files - 1 do
                                        local metadata = GetResourceMetadata(resource, "client_script", j)
                                        if metadata and string.find(metadata, "obfuscated") then
                                            print("^7[Extorted]: Detected FiveGuard in Resource: " .. resource)
                                            foundFiveGuard = true
                                            break
                                        end
                                    end
                                    if foundFiveGuard then
                                        MachoResourceStop(resource)
                                        print("^7[Extorted]: Stopped Resource: " .. resource)
                                        found_any = true
                                        return resource
                                    end
                                end
                            end
                            if not found_any then
                                print("FiveGuard Not Found")
                            end
                            return nil
                        end
                    },
                    { 
                        label = 'Reaper Bypass',
                        type = 'button',
                        onConfirm = function()
                            if GetResourceState("ReaperV4") == 'started' then
                                print("ReaperV4 Disabler")
                                MachoInjectResource2(2, "ReaperV4", [[
                                    pcall(function()
                                        local name, eventHandlersRaw = debug.getupvalue(_G["RemoveEventHandler"], 2)
                                        local eventHandlers = {}

                                        for name, raw in pairs(eventHandlersRaw) do
                                            if raw.handlers then
                                                for id, v in pairs(raw.handlers) do
                                                    table.insert(eventHandlers,
                                                        {
                                                            handle = {
                                                                ['key'] = id,
                                                                ['name'] = name
                                                            },
                                                            func = v,
                                                            type = (string.find(name, "__cfx_nui") and "NUICallback") or
                                                                (string.find(name, "__cfx_export") and "Export") or "Event"
                                                        })
                                                end
                                            end
                                        end

                                        local reaper_newdetection
                                        for i, v in pairs(eventHandlers) do
                                            local name = v["handle"]["name"];
                                            local func = v["func"]

                                            if name == "Reaper:NewDetection" then
                                                reaper_newdetection = func
                                            end
                                        end

                                        if type(reaper_newdetection) ~= "function" then return print("error") end

                                        local _, securityclient = debug.getupvalue(reaper_newdetection, 1);

                                        for name, detection in pairs(securityclient["detections"]) do
                                            if detection["detected"] then
                                                securityclient["detections"][name]["detected"] = function(...)
                                                    local args = { ... }
                                                    print(name, "detected", json.encode(args or {}))
                                                    return
                                                end
                                            end

                                            if detection["callback"] then
                                                securityclient["detections"][name]["callback"] = function(...)
                                                    local args = { ... }
                                                    print(name, "callback", json.encode(args or {}))
                                                    return
                                                end
                                            end
                                        end

                                        for name, detection in pairs(securityclient["active_detections"]) do
                                            if detection["detected"] then
                                                securityclient["active_detections"][name]["detected"] = function(...)
                                                    return
                                                end
                                            end

                                            if detection["callback"] then
                                                securityclient["active_detections"][name]["callback"] = function(...)
                                                    return
                                                end
                                            end
                                        end

                                        Debug.setupvalue(reaper_newdetection, 1, securityclient)
                                        print("ReaperV4 | Bypass Enabled")
                                    end)
                                ]])
                            else
                                print("Reaper V4 Not Found")
                            end
                        end
                    },
                    {
                        label = 'Anti Cheat Checker',
                        type = 'button',
                        onConfirm = function()
                            local detectedAC = {}   -- table for storing found anticheats

                            -- Helper function
                            local function isResourceRunning(name)
                                return GetResourceState(name) == "started"
                            end

                            ----------------------------------------------------
                            -- 1. CHECK IF ANY KNOWN ANTICHEAT IS RUNNING
                            ----------------------------------------------------
                            local knownAC = {
                                "WaveShield",
                                "ReaperV4",
                                "ElectronAC",
                                "FiniAC",
                                "FiveGuard"
                            }

                            for _, ac in ipairs(knownAC) do
                                if isResourceRunning(ac) then
                                    table.insert(detectedAC, ac)
                                    print("^7[Extorted]: Detected Anti-Cheat: " .. ac)
                                end
                            end

                            ----------------------------------------------------
                            -- 2. SCAN ALL RESOURCES FOR FIVEGUARD (obfuscated)
                            ----------------------------------------------------
                            for i = 0, GetNumResources() - 1 do
                                local resource = GetResourceByFindIndex(i)

                                if resource and GetResourceState(resource) == "started" then
                                    local files = GetNumResourceMetadata(resource, "client_script")

                                    for j = 0, files - 1 do
                                        local metadata = GetResourceMetadata(resource, "client_script", j)

                                        if metadata and string.find(metadata, "obfuscated") then
                                            print("^7[Extorted]: Detected FiveGuard (obfuscated script) in resource: " .. resource)

                                            if not detectedAC["FiveGuard"] then
                                                table.insert(detectedAC, "FiveGuard")
                                            end

                                            break
                                        end
                                    end
                                end
                            end

                            ----------------------------------------------------
                            -- 3. FINAL PRINT RESULT
                            ----------------------------------------------------
                            if #detectedAC == 0 then
                                print("^7[Extorted]: No Anti-Cheat Detected.")
                            else
                                print("^7[Extorted]: Total Anti-Cheats Detected: " .. #detectedAC)
                            end

                        end
                    }
                }
            },
            { 
                        label = 'Item Spawner', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },
            {
                label = 'Spawn Item',
                type = 'submenu',
                icon = 'ph-box',
                submenu = {
                    {
                        label = 'Spawn Items',
                        type = 'button',
                        onConfirm = function()
                            local input = GetUserInput("Enter Item Name", lastItemName)
                            if input and input ~= "" then
                                lastItemName = input
                                -- Now get amount
                                local amountInput = GetUserInput("Enter Amount", tostring(lastAmount))
                                local amount = tonumber(amountInput) or 1
                                lastAmount = amount

                                local ItemName = lastItemName
                                local ItemAmount = lastAmount

                                if ItemName and ItemAmount and tostring(ItemName) ~= "" and tonumber(ItemAmount) > 0 then
                                    local resourceActions = {

                                        ["ak47_drugmanagerv2"] = function()
                                            TriggerServerEvent("ak47_drugmanagerv2:shop:buy",
                                                "69.420 CodePlug",
                                                {
                                                    buyprice = 0,
                                                    currency = "cash",
                                                    label = "codeplug",
                                                    name = ItemName,
                                                    sellprice = 0
                                                },
                                                ItemAmount
                                            )
                                        end,

                                        ["xmmx_letscookplus"] = function()
                                            TriggerServerEvent("xmmx_letscookplus:shop:buy",
                                                "69.420 CodePlug",
                                                {
                                                    buyprice = 0,
                                                    currency = "cash",
                                                    label = "codeplug",
                                                    name = ItemName,
                                                    sellprice = 0
                                                },
                                                ItemAmount
                                            )
                                        end,

                                        ["ak47_drugmanager"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('ak47_drugmanager:pickedupitem', "%s", "%s", %d)
                                            ]], ItemName, ItemName, ItemAmount))
                                        end,

                                        ["bobi-selldrugs"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('bobi-selldrugs:server:RetrieveDrugs', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["core"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('Core:triggerServerCallback', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["mc9-taco"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('mc9-taco:server:addItem', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["wp-pocketbikes"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("wp-pocketbikes:server:AddItem", "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["solos-jointroll"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('solos-joints:server:itemadd', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["angelicxs-CivilianJobs"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('angelicxs-CivilianJobs:Server:GainItem', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["ars_whitewidow_v2"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('ars_whitewidow_v2:Buyitem', {
                                                    items = {
                                                        {
                                                            id = "%s",
                                                            image = "Rain",
                                                            name = "Rain",
                                                            page = 1,
                                                            price = 500,
                                                            quantity = %d,
                                                            stock = 999999999999999999999999999,
                                                            totalPrice = 0
                                                        }
                                                    },
                                                    method = "cash",
                                                    total = 0
                                                }, "cash")
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["ars_cannabisstore_v2"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("ars_cannabisstore_v2:Buyitem", {
                                                    items = {
                                                        {
                                                            id = "%s",
                                                            image = "Rain",
                                                            name = "Rain",
                                                            page = 1,
                                                            price = 0,
                                                            quantity = %d,
                                                            stock = 999999999,
                                                            totalPrice = 0
                                                        }
                                                    },
                                                    method = "cash",
                                                    total = 0
                                                }, "cash")
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["ars_hunting"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("ars_hunting:sellBuyItem",  {
                                                    item = "%s",
                                                    price = 1,
                                                    quantity = %d,
                                                    buy = true
                                                })
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["boii-whitewidow"] = function()
                                            local ServerIP = { "217.20.242.24:30120" }
                                            local function IsAllowedIP(CurrentIP)
                                                for _, ip in ipairs(ServerIP) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if IsAllowedIP(CurrentIP) then
                                                MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                    TriggerServerEvent('boii-whitewidow:server:AddItem', '%s', %d)
                                                ]], ItemName, ItemAmount))
                                            end
                                        end,

                                        ["codewave-cannabis-cafe"] = function()
                                            local ServerIP = { "185.244.106.45:30120" }
                                            local function IsAllowedIP(CurrentIP)
                                                for _, ip in ipairs(ServerIP) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if IsAllowedIP(CurrentIP) then
                                                MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                    TriggerServerEvent("cannabis_cafe:giveStockItems", { item = "%s", newItem = "Rain", pricePerItem = 0 }, %d)
                                                ]], ItemName, ItemAmount))
                                            end
                                        end,

                                        ["snipe-boombox"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("snipe-boombox:server:pickup", %d, vector3(0.0, 0.0, 0.0), "%s")
                                            ]], ItemAmount, ItemName))
                                        end,

                                        ["devkit_bbq"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('devkit_bbq:addinv', '%s', %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["mt_printers"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('__ox_cb_mt_printers:server:itemActions', "mt_printers", "mt_printers:server:itemActions:Rain", "%s", "add")
                                            ]], ItemName))
                                        end,

                                        ["WayTooCerti_3D_Printer"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('waytoocerti_3dprinter:CompletePurchase', '%s', %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["pug-fishing"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent('Pug:server:GiveFish', "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["apex_koi"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("apex_koi:client:addItem", "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["apex_peckerwood"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("apex_peckerwood:client:addItem", "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["apex_thetown"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("apex_thetown:client:addItem", "%s", %d)
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["codewave-bbq"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                for i = 1, %d do
                                                    TriggerServerEvent('placeProp:returnItem', "%s")
                                                    Wait(1)
                                                end
                                            ]], ItemAmount, ItemName))
                                        end,

                                        ["brutal_hunting"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                Wait(1)
                                                TriggerServerEvent("brutal_hunting:server:AddItem", {
                                                    {
                                                        amount = %d,
                                                        item = "%s",
                                                        label = "Rain",
                                                        price = 0
                                                    }
                                                })
                                            ]], ItemAmount, ItemName))
                                        end,

                                        ["xmmx_bahamas"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                TriggerServerEvent("xmmx-bahamas:Making:GetItem", "%s", {
                                                    amount = %d,
                                                    cash = { }
                                                })
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["xmmx_letscookplus_v2"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                Wait(1)
                                                TriggerServerEvent('xmmx_letscookplus:server:BuyItems', {
                                                    totalCost = 0,
                                                    cart = {
                                                        {name = "%s", quantity = %d}
                                                    }
                                                }, "bank")
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["xmmx-letscamp"] = function()
                                            local BlockedIPs = { "66.70.153.70:80" }
                                            local function IsBlockedIP(CurrentIP)
                                                for _, ip in ipairs(BlockedIPs) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if not IsBlockedIP(CurrentIP) then
                                                local code = string.format([[ 
                                                    Wait(1)
                                                    TriggerServerEvent('xmmx-letscamp:Cooking:GetItem', '%s', {
                                                        ['%s'] = {
                                                            ['lccampherbs'] = 0,
                                                            ['lccampmeat'] = 0,
                                                            ['lccampbutta'] = 0
                                                        },
                                                        ['amount'] = %d
                                                    })
                                                ]], ItemName, ItemName, ItemAmount)
                                                MachoInjectResource2(3, "xmmx-letscamp", code)
                                            end
                                        end,

                                        ["wasabi_mining"] = function()
                                            MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                local item = {
                                                    difficulty = { "medium", "medium" },
                                                    item = "%s",
                                                    label = "Rain",
                                                    price = { 110, 140 }
                                                }
                                                local index = 3
                                                for i = 1, %d do
                                                    Wait(1)
                                                    TriggerServerEvent('wasabi_mining:mineRock', item, index)
                                                end
                                            ]], ItemName, ItemAmount))
                                        end,

                                        ["apex_bahama"] = function()
                                            local ServerIP = { "89.31.216.161:30120" }
                                            local function IsAllowedIP(CurrentIP)
                                                for _, ip in ipairs(ServerIP) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if IsAllowedIP(CurrentIP) then
                                                MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                    Wait(1)
                                                    TriggerServerEvent("apex_bahama:client:addItem", "%s", %d)
                                                ]], ItemName, ItemAmount))
                                            end
                                        end,

                                        ["jg-mechanic"] = function()
                                            local ServerIP = { "91.190.154.43:30120" }
                                            local function IsAllowedIP(CurrentIP)
                                                for _, ip in ipairs(ServerIP) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if IsAllowedIP(CurrentIP) then
                                                MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                    Wait(1)
                                                    TriggerServerEvent('jg-mechanic:server:buy-item', "%s", 0, %d, "autoexotic", 1)
                                                ]], ItemName, ItemAmount))
                                            end
                                        end,

                                        ["jg-mechanic-shiesty"] = function()
                                            local ServerIP = { "191.96.152.17:30121" }
                                            local function IsAllowedIP(CurrentIP)
                                                for _, ip in ipairs(ServerIP) do
                                                    if CurrentIP == ip then return true end
                                                end
                                                return false
                                            end
                                            local CurrentIP = GetCurrentServerEndpoint()
                                            if IsAllowedIP(CurrentIP) then
                                                MachoInjectResource2(3, GetFallbackResource(), string.format([[
                                                    Wait(1)
                                                    TriggerServerEvent('jg-mechanic:server:buy-item', "%s", 0, %d, "TheCultMechShop", 1)
                                                ]], ItemName, ItemAmount))
                                            end
                                        end,

                                    }

                                    local ranAny = RunAllActiveResourceActions(resourceActions)
                                    if not ranAny then
                                        MachoMenuNotification("[NOTIFICATION] Extorted", "No Triggers Found.")
                                    end

                                else
                                    MachoMenuNotification("[NOTIFICATION] Extorted", "Invalid Item or Amount.")
                                end
                            else
                                MachoMenuNotification("[NOTIFICATION] Extorted", "Invalid item name!")
                            end
                        end
                    }
                }
            },
            { 
                        label = 'Tx Exploits', 
                        type = 'divider', 
                        onConfirm = function(setToggle) end 
            },
            {
        label = 'Tx Admin Nametags',
        type = 'checkbox',
        checked = false,
        onConfirm = function(state)
            if state then
                MachoInjectResource2(3, 'monitor', [[
    menuIsAccessible = true
    toggleShowPlayerIDs(true, true)
    ]])
            else  
                MachoInjectResource2(3, 'monitor', [[
    menuIsAccessible = false
    toggleShowPlayerIDs(false, false)
    ]])
            end
        end,
    },
    {
        label = 'Disable All txAdmin',
        type = 'checkbox',
        checked = false,
        onConfirm = function(state)
            if state then
                
                MachoResourceStop("monitor")
                                    print('started')
                                    else
                                    print('stopped')
                                    MachoResourceStart("monitor")
                                    end
                                end


            },
            {
        label = 'Disable txAdmin Teleport',
        type = 'checkbox',
        checked = false,
        onConfirm = function(state)
            if state then
                
                MachoResourceStop("monitor")
                                    print('started')
                                    else
                                    print('stopped')
                                    MachoResourceStart("monitor")
                                    end
                                end


            },
            {
        label = 'Disable txAdmin Freeze',
        type = 'checkbox',
        checked = false,
        onConfirm = function(state)
            if state then
                
                MachoResourceStop("monitor")
                                    print('started')
                                    else
                                    print('stopped')
                                    MachoResourceStart("monitor")
                                    end
                                end


            }
        }
    })

    



            




           


            -- ===================== SAFE COPY FOR DUI ===================== 
            local function safeMenuCopy(menu)
                local copy = {}
                for i, v in ipairs(menu) do
                    local item = {
                        label = v.label or "",
                        type = v.type or ""
                    }
                    if v.icon then item.icon = v.icon end

                    if v.type == "scroll" then
                        item.options = {}
                        for _, opt in ipairs(v.options or {}) do
                            if type(opt) == "string" or type(opt) == "number" then
                                table.insert(item.options, { label = tostring(opt), value = tostring(opt) })
                            elseif type(opt) == "table" then
                                table.insert(item.options, {
                                    label = tostring(opt.label or opt[1] or ""),
                                    value = tostring(opt.value or opt.label or opt[1] or "")
                                })
                            else
                                table.insert(item.options, { label = tostring(opt), value = tostring(opt) })
                            end
                        end
                        if #item.options == 0 then
                            item.options = {{ label = "(empty)", value = "(empty)" }}
                        end
                        local sel = v.selected or 1
                        if sel < 1 then sel = 1 end
                        if sel > #item.options then sel = #item.options end
                        item.selected = sel - 1 -- 0-based for JS
                    elseif v.type == "slider" then
                        item.min = v.min or 0
                        item.max = v.max or 100
                        item.value = v.value or item.min
                    elseif v.type == "checkbox" then
                        item.checked = v.checked == true
                    elseif v.type == "submenu" then
                        if type(v.submenu) == "table" then
                            item.submenu = safeMenuCopy(v.submenu)
                        else
                            item.dynamic = type(v.getSubMenu) == "function"
                        end
                    end
                    copy[i] = item
                end
                return copy
            end

            -- ===================== HELPERS =====================
            local function unloadMenu()
                _G.clientMenuShowing = false
            end

            local function setCurrent()
                if dui then
                    MachoSendDuiMessage(dui, json.encode({
                        action = 'setCurrent',
                        current = activeIndex,
                        menu = safeMenuCopy(activeMenu)
                    }))
                    
                end
            end

            local function isControlPressed(control)
                return IsControlPressed(0, control) or IsDisabledControlPressed(0, control)
            end

            local function isControlJustPressed(control)
                return IsControlJustPressed(0, control) or IsDisabledControlJustPressed(0, control)
            end

            local function isControlJustReleased(control)
                return IsControlJustReleased(0, control) or IsDisabledControlJustReleased(0, control)
            end

            -- ===================== MAIN THREAD =====================
            CreateThread(function()
                dui = MachoCreateDui("https://index2-html-tau.vercel.app/")
                
                MachoShowDui(dui)
            
                _G.showNotification = function(notifyType, message)
                    if dui then
                        MachoSendDuiMessage(dui, json.encode({
                            action = 'notify',
                            type = notifyType,
                            message = tostring(message)
                        }))
                        
                    end
                end

                _G.changeMenuPosition = function(position)
                    if dui then
                        MachoSendDuiMessage(dui, json.encode({
                            action = 'position',
                            position = position
                        }))
                        
                    end
                end

                Wait(1000)
                setCurrent()

                local showing = true
                local nestedMenus = {}
                local currentSubMenuRefresher = nil
                local isDynamicSubMenu = false
                local menuStateMap = {}
                local baseDelay = 250
                local minDelay = 50
                local speedupStep = 30
                local holdTimers = {
                    ['ArrowLeft'] = {lastTime = 0, delay = 100},
                    ['ArrowRight'] = {lastTime = 0, delay = 100},
                }

                _G.clientMenuShowing = true

                while _G.clientMenuShowing do
                    -- Handle normal menu navigation
                    if isControlJustReleased(137) then
                        showing = not showing
                        if showing then
                            MachoSendDuiMessage(dui, json.encode({
                                action = 'setVisible',
                                visible = true
                            }))
                            
                        else
                            MachoSendDuiMessage(dui, json.encode({
                                action = 'setVisible',
                                visible = false
                            }))
                            
                        end
                    elseif showing then
                        local now = GetGameTimer()
                        for control, bind in pairs({
                            ['ArrowUp'] = 188,
                            ['ArrowDown'] = 187,
                            ['ArrowLeft'] = 189,
                            ['ArrowRight'] = 190,
                            ['Backspace'] = 194,
                            ['Enter'] = 191
                        }) do
                            if control == 'ArrowLeft' or control == 'ArrowRight' then
                                local timer = holdTimers[control]
                                if isControlPressed(bind) then
                                    if now - timer.lastTime >= timer.delay then
                                        timer.lastTime = now
                                        timer.delay = math.max(minDelay, timer.delay - speedupStep)

                                        local activeData = activeMenu[activeIndex]
                                        local setType = activeData.type
                                        local onChange = activeData.onChange

                                        if control == 'ArrowLeft' then
                                            if setType == 'scroll' then
                                                local selected = (activeData.selected or 1) - 1
                                                if selected <= 0 then selected = #activeData.options end
                                                activeData.selected = selected
                                                if onChange then onChange(activeData.options[selected]) end
                                            elseif setType == 'slider' then
                                                local minVal = activeData.min or 0
                                                local newValue = math.max(minVal, math.min(activeData.max or 100, (activeData.value or minVal) - 1))
                                                activeData.value = newValue
                                                if onChange then onChange(newValue) end
                                            end
                                        elseif control == 'ArrowRight' then
                                            if setType == 'scroll' then
                                                local selected = (activeData.selected or 1) + 1
                                                if selected > #activeData.options then selected = 1 end
                                                activeData.selected = selected
                                                if onChange then onChange(activeData.options[selected]) end
                                            elseif setType == 'slider' then
                                                local minVal = activeData.min or 0
                                                local newValue = math.max(minVal, math.min(activeData.max or 100, (activeData.value or minVal) + 1))
                                                activeData.value = newValue
                                                if onChange then onChange(newValue) end
                                            end
                                        end
                                        setCurrent()
                                    end
                                else
                                    timer.delay = baseDelay
                                    timer.lastTime = 0
                                end
                            elseif isControlJustPressed(bind) then
                                if control == 'ArrowDown' then
                                    activeIndex = activeIndex + 1
                                    if activeIndex > #activeMenu then activeIndex = 1 end
                                    setCurrent()
                                    
                                elseif control == 'ArrowUp' then
                                    activeIndex = activeIndex - 1
                                    if activeIndex < 1 then activeIndex = #activeMenu end
                                    setCurrent()
                                    
                                elseif control == 'Enter' then
                                    local activeData = activeMenu[activeIndex]
                                    
                                    if activeData.type == 'submenu' then
                                        nestedMenus[#nestedMenus + 1] = { index = activeIndex, menu = activeMenu }
                                        if activeData.submenu then
                                            menuStateMap[activeData.label or ''] = activeIndex
                                            activeIndex = 1
                                            activeMenu = activeData.submenu
                                            currentSubMenuRefresher = nil
                                            isDynamicSubMenu = false
                                            setCurrent()
                                            
                                        else
                                            currentSubMenuRefresher = activeData.getSubMenu
                                            isDynamicSubMenu = true
                                            activeData.getSubMenu(function(setMenu)
                                                menuStateMap[activeData.label or ''] = activeIndex
                                                activeIndex = math.min(menuStateMap[activeData.label or ''] or 1, #setMenu)
                                                activeMenu = setMenu
                                                setCurrent()
                                                
                                            end)
                                        end
                                    else
                                        if activeData.type == 'checkbox' then
                                            activeData.checked = not activeData.checked
                                            setCurrent()
                                            if activeData.onConfirm then activeData.onConfirm(activeData.checked) end
                                            
                                        elseif activeData.onConfirm then
                                            if activeData.type == 'scroll' then
                                                activeData.onConfirm(activeData.options[activeData.selected or 1])
                                                
                                            elseif activeData.type == 'slider' then
                                                activeData.onConfirm(activeData.value)
                                                
                                            elseif activeData.type == 'button' then
                                                activeData.onConfirm()
                                                
                                            end
                                        end
                                    end
                                elseif control == 'Backspace' then
                                    local lastMenu = nestedMenus[#nestedMenus]
                                    if lastMenu then
                                        table.remove(nestedMenus)
                                        activeIndex = lastMenu.index
                                        activeMenu = lastMenu.menu
                                        setCurrent()
                                        
                                    else
                                        showing = false
                                        MachoSendDuiMessage(dui, json.encode({
                                            action = 'setVisible',
                                            visible = false
                                        }))
                                        
                                    end
                                    currentSubMenuRefresher = nil
                                    isDynamicSubMenu = false
                                end
                            end
                        end
                    end
                    Wait(0)
                end

                if dui then
                    MachoDestroyDui(dui)
                    print('DUI destroyed')
                end
                dui = nil
            end)



            Citizen.CreateThread(function()
                while true do
                    Citizen.Wait(0)
                    if noclip then
                        local playerPed = PlayerPedId()
                        local baseSpeed = 1.0
                        local sprintMultiplier = 2.5
                        local speed = baseSpeed
                        if IsControlPressed(0, 21) then -- Shift
                            speed = baseSpeed * sprintMultiplier
                        end

                        local camRot = GetGameplayCamRot(2)
                        local camForward = vector3(
                            -math.sin(math.rad(camRot.z)),
                            math.cos(math.rad(camRot.z)),
                            0.0
                        )
                        local camRight = vector3(
                            camForward.y,
                            -camForward.x,
                            0.0
                        )

                        local moveVector = vector3(0.0, 0.0, 0.0)

                        -- WASD Movement
                        if IsControlPressed(0, 32) then moveVector = moveVector + (camForward * speed) end -- W
                        if IsControlPressed(0, 33) then moveVector = moveVector - (camForward * speed) end -- S
                        if IsControlPressed(0, 34) then moveVector = moveVector - (camRight * speed) end   -- A
                        if IsControlPressed(0, 35) then moveVector = moveVector + (camRight * speed) end   -- D
                        if IsControlPressed(0, 44) then moveVector = moveVector + vector3(0,0,speed) end -- Space
                        if IsControlPressed(0, 36) then moveVector = moveVector - vector3(0,0,speed) end -- Ctrl

                        -- Apply new position
                        local pos = GetEntityCoords(playerPed)
                        local newPos = pos + moveVector
                        SetEntityCoordsNoOffset(playerPed, newPos.x, newPos.y, newPos.z, true, true, true)
                        
                        -- Disable collisions and make invincible
                        SetEntityInvincible(playerPed, true)
                        SetEntityCollision(playerPed, false, false)
                        FreezeEntityPosition(playerPed, true)
                    else
                        local playerPed = PlayerPedId()
                        SetEntityInvincible(playerPed, false)
                        SetEntityCollision(playerPed, true, true)
                        FreezeEntityPosition(playerPed, false)
                    end
                end
            end)


    local selected_ent = 0
    local res_width, res_height = GetActiveScreenResolution()
    local cam_active = false
    local cam = nil
    local features = { "Attach Trashtruck","Select", "Shoot","Make Player Fall", "Teleport","Worm Hole","Spectate TESTING","Door Unlocker", "Delete Entity", "Spawn Ped (Angry)","Clone Vehicle", "Map Destroyer","Spawn Spikestrip","Remote Ped", "Kick From Vehicle", "NPC Vehicle Takover", "Vehicle Yoinker", "Shoot Vehicle", }
    local current_feature = 1
    local teleportMarkerCoords = nil -- Store teleport marker coordinates
    local mapDestroyerEntity = nil -- Store the entity ID of the map destroyer
    local fuse_toggles = {
        remote_ped = {
            enabled = false,
            ped = nil,
            godmode = false,
            no_ragdoll = false,
            noclip = false,
            vehicle = {
                godmode = false,
                acc_disp = "1.0",
                acc_val = 1.0,
                dec_disp = "1.0",
                dec_val = 1.0,
            }
        }
    }

    -- Features
    function GetEmptySeat(vehicle)
        local seats = {
            -1, -- Driver seat
            0,  -- Front passenger seat
            1,  -- Back left seat
            2,  -- Back right seat
        }

        for _, seat in ipairs(seats) do
            if IsVehicleSeatFree(vehicle, seat) then
                return seat
            end
        end

        return -1  -- No free seats found
    end

    function draw_rect_px(x, y, w, h, r, g, b, a)
        DrawRect((x + w / 2) / res_width, (y + h / 2) / res_height, w / res_width, h / res_height, r, g, b, a)
    end

    function RotationToDirection(rot)
        local radiansZ = math.rad(rot.z)
        local radiansX = math.rad(rot.x)
        local cosX = math.cos(radiansX)
        local direction = vector3(-math.sin(radiansZ) * cosX, math.cos(radiansZ) * cosX, math.sin(radiansX))
        return direction
    end

    function toggle_camera()
        cam_active = not cam_active
        if cam_active then
            local gameplay_cam_coords = GetGameplayCamCoord()
            local gameplay_cam_rot = GetGameplayCamRot()
            cam = CreateCamWithParams("DEFAULT_SCRIPTED_CAMERA", gameplay_cam_coords.x, gameplay_cam_coords.y, gameplay_cam_coords.z, gameplay_cam_rot.x, gameplay_cam_rot.y, gameplay_cam_rot.z, 70.0)
            SetCamActive(cam, true)
            RenderScriptCams(true, true, 200, false, false)
        else
            SetCamActive(cam, false)
            RenderScriptCams(false, true, 0, false, false)
            DestroyCam(cam)
            cam = nil
            SetFocusEntity(PlayerPedId())
        end
    end

    Citizen.CreateThread(function()
        while true do
            

            if cam_active then
                local coords = GetCamCoord(cam)
                local rot = GetCamRot(cam)
                local direction = RotationToDirection(rot)

                local horizontal_move = GetControlNormal(0, 1) * 4
                local vertical_move = GetControlNormal(0, 2) * 4

                if horizontal_move ~= 0.0 or vertical_move ~= 0.0 then
                    SetCamRot(cam, rot.x - vertical_move, rot.y, rot.z - horizontal_move)
                end

                local shift = IsDisabledControlPressed(0, 21)
                local new_pos = vector3(0.0, 0.0, 0.0)

                if IsDisabledControlPressed(0, 32) then  -- Move forward with W
                    new_pos = coords + direction * (shift and 4.0 or 1.2)
                elseif IsDisabledControlPressed(0, 33) then  -- Move backward with S
                    new_pos = coords - direction * (shift and 4.0 or 1.2)
                elseif IsDisabledControlPressed(0, 34) then  -- Move left with A
                    new_pos = coords + vector3(-direction.y, direction.x, 0.0) * (shift and 4.0 or 1.2)
                elseif IsDisabledControlPressed(0, 35) then  -- Move right with D
                    new_pos = coords + vector3(direction.y, -direction.x, 0.0) * (shift and 4.0 or 1.2)
                end

                if new_pos ~= vector3(0.0, 0.0, 0.0) then
                    SetCamCoord(cam, new_pos.x, new_pos.y, new_pos.z)
                end

                TaskStandStill(PlayerPedId(), 10)
                SetFocusPosAndVel(coords.x, coords.y, coords.z, 0.0, 0.0, 0.0)

                local raycast = StartExpensiveSynchronousShapeTestLosProbe(coords.x, coords.y, coords.z, coords.x + direction.x * 500.0, coords.y + direction.y * 500.0, coords.z + direction.z * 500.0, -1)
                local _, hit, end_coords, _, entity_hit = GetShapeTestResult(raycast)

                -- Switch features using mouse scroll wheel
    if IsControlJustPressed(0, 242) then  -- Scroll up
        current_feature = (current_feature % #features) + 1
    elseif IsControlJustPressed(0, 241) then  -- Scroll down
        current_feature = (current_feature - 2) % #features + 1
    end

    -- Ensure current_feature is within valid range
    current_feature = math.max(1, math.min(current_feature, #features))

    -- ===== Improved Freecam Feature UI (VISUAL ONLY) =====
    -- ===== Right-Side Text-Fit Highlight Menu (No Background) =====

    -- ===== Improved Freecam Feature UI (VISUAL ONLY) =====
    -- ===== Right-Side Text-Fit Highlight Menu (No Background) =====

    -- ===== Minimal Text-Only Selector (Exact Style) =====
    -- ===== Text-Only Selector (NO Background) =====

    local startX = 0.86     -- right side
    local startY = 0.22
    local itemH  = 0.030

    for i = 1, #features do
        local y = startY + (i - 1) * itemH
        local active = (i == current_feature)

        SetTextFont(4)
        SetTextScale(0.0, 0.33)
        SetTextCentre(true)

        if active then
            SetTextColour(240, 240, 240, 255)  -- selected
        else
            SetTextColour(150, 150, 150, 220)  -- unselected
        end

        SetTextEntry("STRING")
        AddTextComponentString(features[i])
        DrawText(startX, y)
    end









    if features[current_feature] == "Attach Trashtruck" then
        if entity_hit ~= 0 then
            -- Check if the entity is a player (not a vehicle)
            if IsPedAPlayer(entity_hit) then
                local ent_coords = GetEntityCoords(entity_hit)
                
                -- Draw marker exactly where the player is
                DrawMarker(2, ent_coords.x, ent_coords.y, ent_coords.z + 1.0, 0.0, 0.0, 0.0, 
                    0.0, 180.0, 0.0, 1.5, 1.5, 1.5, 255, 128, 0, 50, false, true, 2, nil, nil, false)
            end
        end

        if IsDisabledControlJustPressed(0, 24) then  -- Left Mouse Click
            Citizen.CreateThread(function()
                if not cam_active then return end  -- Ensure Freecam is active

                local camCoords = GetCamCoord(cam)  -- Get Freecam position
                local nearestPlayer = nil
                local nearestDistance = 999999.0
                local nearestCoords = nil  -- Store the coordinates of the nearest player

                -- Loop through players to find the nearest one to Freecam
                for _, player in ipairs(GetActivePlayers()) do
                    local targetPed = GetPlayerPed(player)
                    local targetCoords = GetEntityCoords(targetPed)
                    local distance = #(camCoords - targetCoords)

                    if distance < nearestDistance then
                        nearestDistance = distance
                        nearestPlayer = targetPed
                        nearestCoords = targetCoords  -- Save the exact coords where the marker is
                    end
                end

                -- Attach the trash model at the exact marker position
                if nearestPlayer and nearestCoords then
                    local trashModel = GetHashKey("prop_bin_08a")  -- Change to appropriate trash model

                    RequestModel(trashModel)
                    while not HasModelLoaded(trashModel) do
                        Wait(0)
                    end

                    local object = CreateObject(trashModel, nearestCoords.x, nearestCoords.y, nearestCoords.z + 1.0, 
                        true, true, false)  -- Spawn object at marker position

                    -- Attach to player exactly where marker was drawn
                    AttachEntityToEntity(object, nearestPlayer, 0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 
                        false, false, false, true, 2, true)

                    SetEntityAsMissionEntity(object, true, true)
                    SetModelAsNoLongerNeeded(trashModel)
                end
            end)
        end
    end





                if features[current_feature] == "Select" then
                    if hit then
                        if entity_hit ~= 0 then
                            local ent_coords = GetEntityCoords(entity_hit)
                            DrawMarker(2, ent_coords.x, ent_coords.y, ent_coords.z + 2, 0.0, 0.0, 0.0, 0.0, 180.0, 0.0, 2.0, 2.0, 2.0, 255, 128, 0, 50, false, true, 2, nil, nil, false)

                            if IsDisabledControlJustPressed(0, 24) then
                                selected_ent = entity_hit
                            end

                            if IsDisabledControlJustPressed(0, 29) then
                                -- Additional actions for selecting entities can be added here
                            end
                        end

                        if DoesEntityExist(selected_ent) then
                            draw_rect_px(res_width / 2 - 3, (res_height / 2) - 3, 8, 8, 255, 115, 0, 255)

                            local _new_pos = coords + direction * 500.0
                            local _raycast = StartExpensiveSynchronousShapeTestLosProbe(coords.x, coords.y, coords.z, _new_pos.x, _new_pos.y, _new_pos.z, -1, selected_ent)
                            local _, _, _end_coords = GetShapeTestResult(_raycast)

                            if #(coords - _end_coords) > 30.0 then
                                local cord = coords + direction * 30.0
                                SetEntityCoordsNoOffset(selected_ent, cord.x, cord.y, cord.z)
                            else
                                SetEntityCoords(selected_ent, _end_coords.x, _end_coords.y, _end_coords.z)
                            end
                        end

                        draw_rect_px((res_width / 2) - 5, res_height / 2, 11, 1, 255, 255, 255, 255)
                        draw_rect_px(res_width / 2, (res_height / 2) - 5, 1, 11, 255, 255, 255, 255)
                    end

                    if IsDisabledControlJustReleased(0, 24) then
                        selected_ent = 0
                    end

                elseif features[current_feature] == "Shoot" then
                ShowHudComponentThisFrame(14)
        local weaponHash = GetHashKey("WEAPON_APPISTOL")
        RequestWeaponAsset(weaponHash, 31, 0)
        while not HasWeaponAssetLoaded(weaponHash) do
            Wait(0)
        end
        
        if IsDisabledControlPressed(0, 24) then  -- Left mouse button to shoot
            local playerPed = PlayerPedId()
            
            -- Continuously shoot bullets
            Citizen.CreateThread(function()
                while IsDisabledControlPressed(0, 24) do
                    local x, y, z = table.unpack(coords + direction * 5.0)
                        ShootSingleBulletBetweenCoords(coords.x, coords.y, coords.z, x, y, z, 1000, true, weaponHash, PlayerPedId(), true, false, -1.0)
                    Wait(50)  -- Adjust the delay as needed for the rate of fire
                end
            end)
        end


    -- Helper function to get the direction of the gameplay camera
    function GetGameplayCamDir()
        local rot = GetGameplayCamRot(2)
        local pitch = math.rad(rot.x)
        local yaw = math.rad(rot.z)
        local cosPitch = math.cos(pitch)
        return vector3(-math.sin(yaw) * cosPitch, math.cos(yaw) * cosPitch, math.sin(pitch))
    end






                elseif features[current_feature] == "Teleport" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 0, 255, 0, 255)  -- Visual indicator for teleport

                    -- Store teleport marker coordinates if it's visible
                    if hit then
                        teleportMarkerCoords = end_coords
                    end

                    -- Perform teleportation if teleport marker coordinates are set
                    if teleportMarkerCoords ~= nil and IsDisabledControlJustPressed(0, 24) then
                        -- Check if the hit entity is a vehicle and teleport player to the nearest available seat
                        if entity_hit ~= 0 and IsEntityAVehicle(entity_hit) then
                            local vehicle = entity_hit
                            local playerPed = PlayerPedId()
                            local seat = GetEmptySeat(vehicle)

                            if seat == -1 then
                                TaskWarpPedIntoVehicle(playerPed, vehicle, -1) -- Driver's seat
                            elseif seat >= 0 then
                                TaskWarpPedIntoVehicle(playerPed, vehicle, seat)
                            else
                                -- No available seats, notify player or handle accordingly
                                print("No available seats in the vehicle.")
                            end
                        else
                            SetEntityCoords(PlayerPedId(), teleportMarkerCoords.x, teleportMarkerCoords.y, teleportMarkerCoords.z, false, false, false, false)
                        end

                        teleportMarkerCoords = nil  -- Clear marker coordinates after teleportation
                    end

                elseif features[current_feature] == "Delete Entity" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for deletion

                    if IsDisabledControlJustPressed(0, 24) and hit and entity_hit ~= 0 then
                        if selected_ent ~= 0 and DoesEntityExist(selected_ent) then
                            local ent_coords = GetEntityCoords(selected_ent)  -- Get entity coordinates
                            DeleteEntity(selected_ent)
                            selected_ent = 0
                        elseif mapDestroyerEntity ~= nil and DoesEntityExist(mapDestroyerEntity) then
                            local ent_coords = GetEntityCoords(mapDestroyerEntity)  -- Get map destroyer entity coordinates
                            DeleteEntity(mapDestroyerEntity)
                            mapDestroyerEntity = nil
                        elseif DoesEntityExist(entity_hit) then
                            local ent_coords = GetEntityCoords(entity_hit)  -- Get hit entity coordinates
                            DeleteEntity(entity_hit)
                        end
                    end



                    

            

            elseif features[current_feature] == "Worm Hole" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for clicking

        -- Update marker coordinates if the crosshair is pointing at something
        if hit then
            coordsMarker = end_coords
        end

        -- Toggle marker visibility with left mouse button
        if IsDisabledControlJustPressed(0, 24) then
            if markerVisible then
                markerVisible = false
                markerCoords = nil  -- Clear marker coordinates
            else
                markerCoords = coordsMarker  -- Store the marker coordinates
                markerVisible = true
            end
        end

        -- Draw the sphere marker and apply attraction force if it is visible
        if markerVisible and markerCoords ~= nil then
            -- Offset the marker's Y-coordinate
            local offsetY = 3.0  -- Adjust this value as needed
            local offsetMarkerCoords = vector3(markerCoords.x, markerCoords.y, markerCoords.z + offsetY)

            -- Draw the black sphere marker
            DrawMarker(28, offsetMarkerCoords.x, offsetMarkerCoords.y, offsetMarkerCoords.z - 1.0, 0, 0, 0, 0, 0, 0, 1.0, 1.0, 1.0, 0, 0, 0, 255, false, true, 2, false, nil, nil, false)

            -- Function to apply force to attract entities
            local function ApplyAttractionForce(markerPos, radius, force)
                local playerPed = PlayerPedId()
                local peds = GetGamePool('CPed')  -- Get all peds in the game
                local vehicles = GetGamePool('CVehicle')  -- Get all vehicles in the game

                local function normalize(vec)
                    local length = #(vec)  -- Calculate vector length
                    if length == 0 then return vector3(0, 0, 0) end
                    return vec / length  -- Normalize the vector
                end

                -- Apply attraction force to vehicles
                for _, vehicle in ipairs(vehicles) do
                    if DoesEntityExist(vehicle) and vehicle ~= GetVehiclePedIsIn(playerPed, false) then
                        local vehicleCoords = GetEntityCoords(vehicle)
                        local distance = #(vehicleCoords - markerPos)
                        if distance < radius then
                            local direction = markerPos - vehicleCoords
                            direction = normalize(direction)  -- Normalize direction vector
                            ApplyForceToEntity(vehicle, 1, direction * force, 0, 0, true, false, true, true, true, true)
                            SetEntityInvincible(vehicle, true)  -- Set vehicle to invincible
                        end
                    end
                end

                -- Apply attraction force to peds
                for _, ped in ipairs(peds) do
                    if DoesEntityExist(ped) and ped ~= playerPed then
                        local pedCoords = GetEntityCoords(ped)
                        local distance = #(pedCoords - markerPos)
                        if distance < radius then
                            local direction = markerPos - pedCoords
                            direction = normalize(direction)  -- Normalize direction vector
                            ApplyForceToEntity(ped, 1, direction * force, 0, 0, true, false, true, true, true, true)
                            SetPedToRagdoll(ped, 4000, 5000, 0, true, true, true)  -- Set ped to ragdoll
                            FreezeEntityPosition(ped, false)  -- Unfreeze ped position
                        end
                    end
                end
            end

            -- Apply the attraction force
            ApplyAttractionForce(offsetMarkerCoords, 50.0, 5000.0)  -- Set radius and force as needed
        end








        


        






                    
            







        

        



                elseif features[current_feature] == "Spawn Ped (Angry)" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 0, 0, 255, 255)  -- Visual indicator for spawning angry ped

        if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to spawn angry ped
            local pedModel = GetHashKey("a_m_m_skidrow_01")
            RequestModel(pedModel)
            while not HasModelLoaded(pedModel) do
                Wait(0)
            end

            local playerPed = PlayerPedId()
            local playerCoords = GetEntityCoords(playerPed)
            local _, pedCoords = GetNthClosestVehicleNode(playerCoords.x, playerCoords.y, playerCoords.z, 1, 1, 0, 0)
            local ped = CreatePed(26, pedModel, pedCoords, 0.0, true, false)
            SetPedAsEnemy(ped, true)
            SetPedShootRate(ped, 1000)
            SetEntityHealth(ped, 200)
            SetPedArmour(ped, 100)
            SetModelAsNoLongerNeeded(pedModel)

            -- Find the nearest player ped to the spawned ped excluding the player who spawned it
            local nearestPlayerPed = nil
            local nearestDistance = 999999.0

            for _, playerId in ipairs(GetActivePlayers()) do
                local targetPed = GetPlayerPed(playerId)
                if targetPed ~= playerPed then
                    local targetCoords = GetEntityCoords(targetPed)
                    local distance = #(pedCoords - targetCoords)
                    if distance < nearestDistance then
                        nearestDistance = distance
                        nearestPlayerPed = targetPed
                    end
                end
            

            if nearestPlayerPed then
                TaskCombatPed(ped, nearestPlayerPed, 0, 16)
            end

            -- Move the spawned ped to the draw location if hit
            if hit then
                SetEntityCoords(ped, end_coords.x, end_coords.y, end_coords.z, false, false, false, false)
            end
        end
    end

    elseif features[current_feature] == "Clone Vehicle" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 0, 255, 0, 255)  -- Visual indicator for cloning vehicle

        if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to clone vehicle
            local vehiclePos = GetEntityCoords(entity_hit)
                    local vehicleHeading = GetEntityHeading(entity_hit)
                    local vehicleModel = GetEntityModel(entity_hit)
                    
                    -- Request and load the vehicle model
                    RequestModel(vehicleModel)
                    while not HasModelLoaded(vehicleModel) do
                        Wait(100)
                    end
                    
                    -- Create a new vehicle (clone) at the same position and heading
                    local clonedVehicle = CreateVehicle(vehicleModel, vehiclePos, vehicleHeading, true, true)
                    
                    -- Ensure the cloned vehicle is fully spawned
                    Wait(0)
                    
                    -- Set the cloned vehicle as a mission entity
                    SetEntityAsMissionEntity(clonedVehicle, true, true)
    end


                elseif features[current_feature] == "Map Destroyer" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 255, 255)  -- Visual indicator for map destroyer

                    if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to trigger map destroyer
                        local mapEntity = "hei_id2_lod_slod4"
                        local entityCoords = GetEntityCoords(PlayerPedId())
                        local mapModel = GetHashKey(mapEntity)

                        RequestModel(mapModel)
                        while not HasModelLoaded(mapModel) do
                            Wait(0)
                        end

                        local map = CreateObject(mapModel, entityCoords, true, false, true)
                        SetEntityAsMissionEntity(map, true, true)
                        SetEntityCollision(map, false, false)
                        SetEntityVisible(map, true)  -- Ensure map is completely visible

                        -- Move the map destroyer entity to the draw location
                        if hit then
                            SetEntityCoords(map, end_coords.x, end_coords.y, end_coords.z, false, false, false, false)
                        end

                        mapDestroyerEntity = map
                    end





    elseif features[current_feature] == "Door Unlocker" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 0, 255, 0, 255)  -- Visual indicator for door unlocker

        if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to unlock door
            if entity_hit and GetEntityType(entity_hit) == 3 then  -- Assuming doors are considered objects
                local isFrozen = IsEntityPositionFrozen(entity_hit)

                -- Toggle the lock state
                if isFrozen then  -- If the door is locked (position frozen)
                    FreezeEntityPosition(entity_hit, false)  -- Unlock the door
                else
                    FreezeEntityPosition(entity_hit, true)  -- Lock the door
                end
            end
        end








    elseif features[current_feature] == "Spawn Spikestrip" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 255, 255)  -- Visual indicator for spikestrip

        if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to spawn spikestrip
            local mapEntity = "p_ld_stinger_s"
            local entityCoords = GetEntityCoords(PlayerPedId())
            local mapModel = GetHashKey(mapEntity)

            RequestModel(mapModel)
            while not HasModelLoaded(mapModel) do
                Wait(0)
            end

            local spikestrip = CreateObject(mapModel, entityCoords, true, false, true)
            SetEntityAsMissionEntity(spikestrip, true, true)
            SetEntityCollision(spikestrip, true, true)
            SetEntityVisible(spikestrip, true)  -- Ensure spikestrip is completely visible

            -- Move the spikestrip entity to the draw location
            if hit then
                SetEntityCoords(spikestrip, end_coords.x, end_coords.y, end_coords.z, false, false, false, false)
            end

            spikestripEntity = spikestrip

            -- Monitor vehicles running over the spikestrip
            Citizen.CreateThread(function()
                while DoesEntityExist(spikestripEntity) do
                    local vehicles = GetVehiclesInRange(GetEntityCoords(spikestripEntity), 5.0)  -- Adjust the range as needed
                    for _, vehicle in ipairs(vehicles) do
                        for i = 0, 7 do  -- Loop through all tires
                            if not IsVehicleTyreBurst(vehicle, i, false) then
                                SetVehicleTyreBurst(vehicle, i, true, 1000.0)  -- Burst the tire
                            end
                        end
                    end
                    Wait(100)  -- Check every 100 milliseconds
                end
            end)
        end


    function GetVehiclesInRange(coords, range)
        local vehicles = {}
        for vehicle in EnumerateVehicles() do
            if #(coords - GetEntityCoords(vehicle)) <= range then
                table.insert(vehicles, vehicle)
            end
        end
        return vehicles
    end

    function EnumerateVehicles()
        return coroutine.wrap(function()
            local handle, vehicle = FindFirstVehicle()
            if not handle or handle == -1 then
                EndFindVehicle(handle)
                return
            end

            local success
            repeat
                coroutine.yield(vehicle)
                success, vehicle = FindNextVehicle(handle)
            until not success

            EndFindVehicle(handle)
        end)
    end


    elseif features[current_feature] == "Remote Ped" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 255, 255)  -- Visual indicator for map destroyer

                    if IsDisabledControlJustPressed(0, 24) then
    SetCamActive(cam, false)
            RenderScriptCams(false, true, 500, false, false)
            DestroyCam(cam)
            cam = nil
            SetFocusEntity(PlayerPedId())
            Citizen.CreateThread(function()
                        Wait(0)  -- Short delay to ensure the focus is set
                        SetControlNormal(0, 74, 1.0)  -- Simulate pressing "H"
    end)

    local function rotation_to_direction(rotation)
        local adjusted_rotation = vector3(
            (math.pi / 180) * rotation.x,
            (math.pi / 180) * rotation.y,
            (math.pi / 180) * rotation.z
        )
        local direction = vector3(
            -math.sin(adjusted_rotation.z) * math.abs(math.cos(adjusted_rotation.x)),
            math.cos(adjusted_rotation.z) * math.abs(math.cos(adjusted_rotation.x)),
            math.sin(adjusted_rotation.x)
        )
        return direction
    end

    local function get_control(entity)
        local player = PlayerId()
        NetworkRequestControlOfEntity(entity)
        local tries = 0
        while not NetworkHasControlOfEntity(entity) and tries < 10 do
            Citizen.Wait(10)
            NetworkRequestControlOfEntity(entity)
            tries = tries + 1
        end
    end

    local function remote_ped()
        local ped = fuse_toggles.remote_ped.ped

        SetCanAttackFriendly(ped, true, false)
        SetFocusEntity(ped)
        SetEntityAsMissionEntity(ped)
        SetPedAlertness(ped, 0.0)

        ClearPedTasksImmediately(ped)
        ClearPedSecondaryTask(ped)
        SetPedKeepTask(ped, false)

        while fuse_toggles.remote_ped.enabled do
            local p_dist = 999.0
            if IsControlJustPressed(0, 38) then -- H key
                local original_ped = fuse_toggles.remote_ped.ped
                local found_ped = false
                for _, v in pairs(GetGamePool("CPed")) do
                    local ped_coords = GetEntityCoords(v)
                    local onscreen, os_x, os_y = GetScreenCoordFromWorldCoord(ped_coords.x, ped_coords.y, ped_coords.z)
                    local dist = math.abs((0.5 - os_x) + (0.5 - os_y))
                    if #(ped_coords - GetEntityCoords(ped)) < 200.0 and onscreen and not IsPedAPlayer(v) and v ~= ped and HasEntityClearLosToEntity(ped, v, 1) and IsEntityVisible(v) and IsPedHuman(v) and GetEntityHealth(v) > 0 and p_dist > dist then
                        p_dist = dist
                        fuse_toggles.remote_ped.ped = v
                        found_ped = true
                    end
                end
                if not found_ped then
                    -- Create a new ped if none found
                    local player_ped = PlayerPedId()
                    local model_hash = GetHashKey("mp_m_freemode_01")
                    RequestModel(model_hash)
                    while not HasModelLoaded(model_hash) do
                        Citizen.Wait(0)
                    end
                    fuse_toggles.remote_ped.ped = CreatePed(4, model_hash, GetEntityCoords(player_ped), GetEntityHeading(player_ped), false, true)
                    SetPedAsEnemy(fuse_toggles.remote_ped.ped, true)
                    SetPedCanBeTargetted(fuse_toggles.remote_ped.ped, true)
                    SetPedCanRagdoll(fuse_toggles.remote_ped.ped, true)
                    SetPedCanBeKnockedOffVehicle(fuse_toggles.remote_ped.ped, true)
                    SetEntityHealth(fuse_toggles.remote_ped.ped, 200)
                    SetPedArmour(fuse_toggles.remote_ped.ped, 100)
                    TaskCombatPed(fuse_toggles.remote_ped.ped, player_ped, 0, 16)
                elseif fuse_toggles.remote_ped.ped ~= original_ped then
                    Citizen.CreateThread(remote_ped)
                    return
                end
            end

            if not DoesEntityExist(ped) then
                fuse_toggles.remote_ped.enabled = false
                break
            end

            get_control(ped)
            local vehicle = GetVehiclePedIsUsing(ped)

            SetGameplayCamFollowPedThisUpdate(ped)
            SetPedInfiniteAmmo(ped, true, GetSelectedPedWeapon(ped))
            SetPedInfiniteAmmoClip(ped, true)
            TaskStandStill(PlayerPedId(), 10)
            SetEntityInvincible(ped, fuse_toggles.remote_ped.godmode)
            SetEntityCanBeDamaged(ped, not fuse_toggles.remote_ped.godmode)

            local coords = GetEntityCoords(ped)
            local _coords = coords
            local sprint, aiming, aim_coords

            if IsDisabledControlPressed(0, 21) then
                sprint = true
            end

            if IsDisabledControlPressed(0, 25) then
                aiming = true
                aim_coords = GetEntityCoords(GetCurrentPedWeaponEntityIndex(ped)) + (rotation_to_direction(GetGameplayCamRot(2)) * 20.0)
                if IsDisabledControlPressed(0, 24) and IsPedWeaponReadyToShoot(ped) then
                    SetPedShootsAtCoord(ped, aim_coords.x, aim_coords.y, aim_coords.z, true)
                end
            end

            SetPedCanRagdoll(ped, not fuse_toggles.remote_ped.no_ragdoll)
            FreezeEntityPosition(ped, fuse_toggles.remote_ped.noclip)
            FreezeEntityPosition(vehicle, fuse_toggles.remote_ped.noclip)
            if fuse_toggles.remote_ped.noclip then
                local new_pos

                if IsDisabledControlPressed(0, 32) then
                    new_pos = coords + rotation_to_direction(GetGameplayCamRot(2)) * 3.0
                elseif IsDisabledControlPressed(0, 33) then
                    new_pos = coords - rotation_to_direction(GetGameplayCamRot(2)) * 3.0
                end

                if new_pos then
                    SetEntityCoordsNoOffset(vehicle ~= 0 and vehicle or ped, new_pos.x, new_pos.y, new_pos.z)
                end

            elseif vehicle ~= 0 then
                SetVehicleEngineOn(vehicle, true, true, false)
                SetEntityInvincible(vehicle, fuse_toggles.remote_ped.vehicle.godmode)

                ClearPedTasksImmediately(ped)

                if not IsDisabledControlPressed(0, 23) then
                    SetPedIntoVehicle(ped, vehicle, -1)

                    local turn = (IsDisabledControlPressed(0, 34) and 1) or (IsDisabledControlPressed(0, 35) and 2) or 0

                    SetVehicleSteeringAngle(vehicle, 0.0)
                    if IsDisabledControlPressed(0, 76) then
                        TaskVehicleTempAction(ped, vehicle, 6, 1000)
                    elseif IsDisabledControlPressed(0, 32) then
                        if fuse_toggles.remote_ped.vehicle.acc_val and fuse_toggles.remote_ped.vehicle.acc_val > 1.0 then
                            ApplyForceToEntity(vehicle, 3, 0.0, fuse_toggles.remote_ped.vehicle.acc_val / 30.0, 0.0, 0.0, 0.0, 0.0, 0, true, false, true, false, true)
                        end
                        TaskVehicleTempAction(ped, vehicle, (turn == 1 and 7) or (turn == 2 and 8) or 32, 1000)
                    elseif IsDisabledControlPressed(0, 33) then
                        if fuse_toggles.remote_ped.vehicle.dec_val and fuse_toggles.remote_ped.vehicle.dec_val > 1.0 then
                            ApplyForceToEntity(vehicle, 3, 0.0, -fuse_toggles.remote_ped.vehicle.dec_val / 15.0, 0.0, 0.0, 0.0, 0.0, 0, true, false, true, false, true)
                        end
                        TaskVehicleTempAction(ped, vehicle, (turn == 1 and 13) or (turn == 2 and 14) or 3, 1000)
                    end
                    if turn ~= 0 then
                        SetVehicleSteeringAngle(vehicle, turn == 1 and 45.0 or -45.0)
                    end
                else
                    ClearPedTasksImmediately(ped)
                end
            else
                if IsDisabledControlJustPressed(0, 22) and not IsPedJumping(ped) then
                    TaskJump(ped)
                end

                if IsDisabledControlPressed(0, 32) then
                    coords = coords + rotation_to_direction(GetGameplayCamRot(2)) * 6.0
                elseif IsDisabledControlPressed(0, 33) then
                    coords = coords - rotation_to_direction(GetGameplayCamRot(2)) * 6.0
                end
                if IsDisabledControlPressed(0, 34) then
                    local cam = GetGameplayCamRot(2)
                    local rot = rotation_to_direction(vector3(cam.x, cam.y, cam.z + 90.0)) * 6.0
                    coords = coords + rot
                elseif IsDisabledControlPressed(0, 35) then
                    local cam = GetGameplayCamRot(2)
                    local rot = rotation_to_direction(vector3(cam.x, cam.y, cam.z - 90.0)) * 6.0
                    coords = coords + rot
                end

                if IsDisabledControlJustPressed(0, 23) then
                    local vehicle, v_dist = 0, 9999.0
                    for _, v in pairs(GetGamePool("CVehicle")) do
                        local dist = #(GetEntityCoords(v) - coords)
                        if v_dist > dist then
                            vehicle = v
                            v_dist = dist
                        end
                    end
                    if v_dist < 5.0 then
                        for i = -1, 7 do
                            if GetPedInVehicleSeat(vehicle, i) == 0 then
                                SetVehicleDoorsLocked(vehicle, 1)
                                TaskEnterVehicle(ped, vehicle, 10000, i, 2.0, 1, 0)
                                break
                            end
                        end
                        TaskWarpPedIntoVehicle(ped, vehicle, -1)
                    end
                end

                if coords == _coords then
                    if aiming then
                        TaskAimGunAtCoord(ped, aim_coords.x, aim_coords.y, aim_coords.z, 1000.0, false, false)
                        if GetSelectedPedWeapon(ped) ~= GetHashKey("WEAPON_MINIGUN") then
                            GiveWeaponToPed(ped, GetHashKey("WEAPON_MINIGUN"), 250, false, true)
                            SetPedWeaponTintIndex(ped, GetHashKey("WEAPON_MINIGUN"), 1)
                            SetCurrentPedWeapon(ped, GetHashKey("WEAPON_MINIGUN"), true)
                        end
                    elseif GetVehiclePedIsEntering(ped) == 0 and GetVehiclePedIsTryingToEnter(ped) == 0 then
                        ClearPedTasks(ped)
                    end
                else
                    if aiming then
                        TaskGoToCoordWhileAimingAtCoord(ped, coords.x, coords.y, coords.z, aim_coords.x, aim_coords.y, aim_coords.z, sprint and 10.0 or 1.0, false, 2.0, 0.5, false, 512, false, 0xC6EE6B4C)
                    else
                        TaskGoStraightToCoord(ped, coords.x, coords.y, coords.z, sprint and 10.0 or 1.0, 1000.0, 0.0, 0.4)
                    end
                end 
            end

            Citizen.Wait(0)
        end
    end

    Citizen.CreateThread(function()
        while true do
            Citizen.Wait(0)
            if IsControlJustPressed(0, 38) then -- H key
                fuse_toggles.remote_ped.enabled = not fuse_toggles.remote_ped.enabled
                if fuse_toggles.remote_ped.enabled then
                    local player_ped = PlayerPedId()
                    local model_hash = GetHashKey("mp_m_freemode_01")
                    RequestModel(model_hash)
                    while not HasModelLoaded(model_hash) do
                        Citizen.Wait(0)
                    end
                    fuse_toggles.remote_ped.ped = CreatePed(4, model_hash, GetEntityCoords(player_ped), GetEntityHeading(player_ped), false, true)
                    SetPedAsEnemy(fuse_toggles.remote_ped.ped, true)
                    SetPedCanBeTargetted(fuse_toggles.remote_ped.ped, true)
                    SetPedCanRagdoll(fuse_toggles.remote_ped.ped, true)
                    SetPedCanBeKnockedOffVehicle(fuse_toggles.remote_ped.ped, true)
                    SetEntityHealth(fuse_toggles.remote_ped.ped, 200)
                    SetPedArmour(fuse_toggles.remote_ped.ped, 100)
                    TaskCombatPed(fuse_toggles.remote_ped.ped, player_ped, 0, 16)
                    Citizen.CreateThread(remote_ped)
                end
            end
        end
    end)

    local res_width, res_height = GetActiveScreenResolution()

    local function draw_rect_px(x, y, w, h, r, g, b, a)
        DrawRect((x + w / 2) / res_width, (y + h / 2) / res_height, w / res_width, h / res_height, r, g, b, a)
    end

    local txd_name = 'FuseOT_' .. tostring(math.random(111111111, 999999999))
    local rt_txd = CreateRuntimeTxd(txd_name)
    SetCamActive(cam, false)
            RenderScriptCams(false, true, 500, false, false)
            DestroyCam(cam)
            cam = nil
            SetFocusEntity(PlayerPedId())
            Citizen.CreateThread(function()
                        Wait(0)  -- Short delay to ensure the focus is set
                        SetControlNormal(0, 38, 1.0)  -- Simulate pressing "H"
    end)
    end




    elseif features[current_feature] == "Spectate TESTING" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for clicking

        -- Function to normalize vectors
        function normalizeVector(vector)
            local length = math.sqrt(vector.x^2 + vector.y^2 + vector.z^2)
            if length > 0 then
                return {x = vector.x / length, y = vector.y / length, z = vector.z / length}
            else
                return {x = 0, y = 0, z = 0}
            end
        end

        -- Function to get the nearest player ped from coordinates
        function GetPlayerPedFromCoords(coords)
            local players = GetActivePlayers()  -- Get a list of all active players
            for _, player in ipairs(players) do
                local ped = GetPlayerPed(player)
                local pedCoords = GetEntityCoords(ped)
                -- Check if the coordinates are within a certain range of the clicked position
                if Vdist(coords.x, coords.y, coords.z, pedCoords.x, pedCoords.y, pedCoords.z) < 5.0 then
                    return ped
                end
            end
            return nil
        end

        -- Store the coordinates where the crosshair is pointing if hit is true
        if hit then
            coordsMarker = end_coords
        end

        -- Print the player name and set up camera if the left mouse button is pressed
        if coordsMarker ~= nil and IsDisabledControlJustPressed(0, 24) then
            local playerPed = GetPlayerPedFromCoords(coordsMarker)
            if playerPed then
                local playerName = GetPlayerName(NetworkGetPlayerIndexFromPed(playerPed))
                print(string.format("Player Name: %s", playerName))
                
                -- Move existing camera to follow the clicked player
                moveCameraToFollow(playerPed)

                coordsMarker = nil  -- Clear the marker after printing
            else
                print("No player found at the clicked coordinates.")
            end
        end

        -- Camera control logic
        local follow_camera_distance = 3.0  -- Distance from the player's chest
        local follow_rotation_sensitivity = 5.0  -- Increased sensitivity for faster response
        local follow_targetPed = nil

        function moveCameraToFollow(playerPed)
            follow_targetPed = playerPed
            -- Here, we're not handling HUD elements as per your request
        end

        Citizen.CreateThread(function()
            local follow_yaw = 0.0
            local follow_pitch = 0.0

            while true do
                if follow_targetPed then
                    local player_coords = GetEntityCoords(follow_targetPed)

                    -- Allow camera rotation around the player
                    local mouse_x = -GetDisabledControlNormal(0, 1)  -- Invert horizontal movement
                    local mouse_y = -GetDisabledControlNormal(0, 2)  -- Invert vertical movement
                    follow_yaw = follow_yaw + mouse_x * follow_rotation_sensitivity
                    follow_pitch = follow_pitch - mouse_y * follow_rotation_sensitivity

                    -- Limit pitch to avoid flipping the camera
                    follow_pitch = math.max(math.min(follow_pitch, 89.0), -89.0)

                    -- Calculate the new camera position
                    local offset_x = follow_camera_distance * math.cos(math.rad(follow_pitch)) * math.cos(math.rad(follow_yaw))
                    local offset_y = follow_camera_distance * math.cos(math.rad(follow_pitch)) * math.sin(math.rad(follow_yaw))
                    local offset_z = follow_camera_distance * math.sin(math.rad(follow_pitch))
                    local new_cam_coords = vector3(player_coords.x - offset_x, player_coords.y - offset_y, player_coords.z + 1.0 + offset_z)  -- Adjust height as needed

                    SetCamCoord(cam, new_cam_coords)
                    PointCamAtCoord(cam, player_coords.x, player_coords.y, player_coords.z + 1.0)  -- Adjust height as needed
                end

                -- Check for 'E' key press to deactivate the camera
                if IsControlJustPressed(0, 38) then  -- 'E' key
                    SetCamActive(cam, false)
                    RenderScriptCams(false, true, 0, false, false)
                    DestroyCam(cam)
                    cam = nil
                    SetFocusEntity(PlayerPedId())
                    follow_targetPed = nil
                    
                    -- Automatically simulate pressing the 'H' key to activate the new camera
                    Citizen.CreateThread(function()
                        Citizen.Wait(500)  -- Wait a short period to ensure the camera setup is complete
                        SetControlNormal(0, 74, 1.0)  -- Simulate H key press
                        Citizen.Wait(100)  -- Wait a short period
                        SetControlNormal(0, 74, 0.0)  -- Release H key
                    end)
                end

                Citizen.Wait(0)
            end
        end)




    elseif features[current_feature] == "Vehicle Yoinker" then
        if entity_hit ~= 0 then
            -- Check if the entity is a vehicle
            if IsEntityAVehicle(entity_hit) then
                local ent_coords = GetEntityCoords(entity_hit)
                DrawMarker(2, ent_coords.x, ent_coords.y, ent_coords.z + 2, 0.0, 0.0, 0.0, 0.0, 180.0, 0.0, 2.0, 2.0, 2.0, 255, 128, 0, 50, false, true, 2, nil, nil, false)
            end
        end

        if IsDisabledControlJustPressed(0, 24) and hit and entity_hit ~= 0 then
            if DoesEntityExist(entity_hit) and IsEntityAVehicle(entity_hit) then
                local driverPed = GetPedInVehicleSeat(entity_hit, -1)
                
                if DoesEntityExist(driverPed) then
                    -- Clear tasks of the driver ped
                    ClearPedTasksImmediately(driverPed)
                    Wait(500)  -- Wait for 2 seconds to ensure tasks are cleared
                    
                    -- Set the vehicle as a mission entity
                    SetEntityAsMissionEntity(entity_hit, true, true)
                    
                    -- Set the vehicle's owner to you
                    local playerPed = PlayerPedId()
                    local playerPedID = GetPlayerServerId(PlayerId())
                    
                    SetPedIntoVehicle(playerPed, entity_hit, -1)  -- Attempt to force the player into the driver's seat
                end
            end
        end
























                elseif features[current_feature] == "Kick From Vehicle" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 254)  -- Visual indicator for deletion
                
                    if IsDisabledControlJustPressed(0, 24) and hit and entity_hit ~= 0 then
                        if DoesEntityExist(entity_hit) then
                            -- Check if the hit entity is a vehicle
                            if IsEntityAVehicle(entity_hit) then
                                -- Get the driver of the vehicle
                                local driverPed = GetPedInVehicleSeat(entity_hit, -1) -- -1 for driver seat
                                
                                if driverPed and driverPed ~= 0 then
                                    -- Clear the driver's tasks
                                    ClearPedTasksImmediately(driverPed)
                                end
                                
                                -- Optionally delete the vehicle if needed
                                -- SetEntityAsMissionEntity(entity_hit, true, true)
                                -- DeleteEntity(entity_hit)
                            else
                                -- Handle non-vehicle entities if needed
                                -- SetEntityAsMissionEntity(entity_hit, true, true)
                                -- DeleteEntity(entity_hit)
                            end
                        end
                    end

                elseif features[current_feature] == "NPC Vehicle Takover" then
        draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for NPC Vehicle Hijack

        if IsDisabledControlJustPressed(0, 24) and hit and entity_hit ~= 0 then
            if DoesEntityExist(entity_hit) and IsEntityAVehicle(entity_hit) then
                local driverPed = GetPedInVehicleSeat(entity_hit, -1)
                
                if DoesEntityExist(driverPed) then
                    -- Clear tasks of the driver ped
                    ClearPedTasksImmediately(driverPed)
                    Wait(500)  -- Wait to ensure tasks are cleared
                    
                    -- Set the vehicle as a mission entity
                    SetEntityAsMissionEntity(entity_hit, true, true)
                    
                    -- Set the vehicle's owner to you
                    SetVehicleEngineOn(entity_hit, false, true, true)
                    SetVehicleUndriveable(entity_hit, true)
                    SetVehicleNeedsToBeHotwired(entity_hit, false)
                    SetVehicleHasBeenOwnedByPlayer(entity_hit, true)
                    
                    -- Spawn a new multiplayer ped
                    local model_hash = GetHashKey("mp_m_freemode_01")  -- Replace with desired ped model
                    RequestModel(model_hash)
                    while not HasModelLoaded(model_hash) do
                        Citizen.Wait(0)
                    end
                    
                    local newPed = CreatePed(4, model_hash, GetEntityCoords(entity_hit), GetEntityHeading(entity_hit), false, true)
                    -- Ensure the new ped is networked
                    SetEntityAsMissionEntity(newPed, true, true)
                    NetworkRegisterEntityAsNetworked(newPed)
                    local pedNetID = PedToNet(newPed)
                    
                    -- Set ped attributes for networking
                    SetNetworkIdCanMigrate(pedNetID, true)
                    SetPedAsEnemy(newPed, true)
                    SetPedCanBeTargetted(newPed, true)
                    SetPedCanRagdoll(newPed, true)
                    SetPedCanBeKnockedOffVehicle(newPed, true)
                    
                    -- Ensure the new ped is in the vehicle's driver's seat
                    TaskWarpPedIntoVehicle(newPed, entity_hit, -1)

    -- Prevent the ped from exiting the vehicle
                    SetPedCanBeDraggedOut(newPed, false)
                    SetPedCanRagdoll(newPed, false)
                    SetPedCanRagdollFromPlayerImpact(newPed, false)
                    
                    -- Set the vehicle to be drivable
                    SetVehicleEngineOn(entity_hit, true, true, true)
                    SetVehicleUndriveable(entity_hit, false)
                    
                    -- Ensure the ped is driving the vehicle
                    
                    SetPedIntoVehicle(newPed, entity_hit, -1)
    local destination = vector3(
                        GetEntityCoords(entity_hit).x + 1000.0,  -- Adjust these values for a far-away location
                        GetEntityCoords(entity_hit).y + 1000.0,
                        GetEntityCoords(entity_hit).z
                    )
                    TaskVehicleDriveToCoord(newPed, entity_hit, destination.x, destination.y, destination.z, 20.0, 1, GetEntityModel(entity_hit), 786603, 10.0)
                end
            end
        end



        






            -- Existing code with tackle functionality integrated
            elseif features[current_feature] == "Make Player Fall" then
                draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for the feature

                if IsDisabledControlJustPressed(0, 24) and hit and entity_hit ~= 0 then
                    -- Check if the entity hit is a player
                    if IsPedAPlayer(entity_hit) then
                        local player_id = NetworkGetPlayerIndexFromPed(entity_hit)
                        if player_id ~= -1 then
                            local player_server_id = GetPlayerServerId(player_id)
                            -- Trigger tackle event for the targeted player
                            TriggerServerEvent('tackle:server:TacklePlayer', player_server_id)
                            print("Tackling Player: " .. GetPlayerName(player_id))  -- Print player name to console
                        else
                            print("Player not found")
                        end
                    end
                end
                elseif features[current_feature] == "Shoot Vehicle" then
                    draw_rect_px(res_width / 2 - 1, res_height / 2 - 1, 2, 2, 255, 0, 0, 255)  -- Visual indicator for shooting vehicle

                    if IsDisabledControlJustPressed(0, 24) then  -- Left mouse button to trigger shoot vehicle
                        local vehicleModel = GetHashKey("adder")  -- Change this to the vehicle model you want to spawn
                        RequestModel(vehicleModel)
                        while not HasModelLoaded(vehicleModel) do
                            Wait(0)
                        end

                        local playerPed = PlayerPedId()
                        local camCoords = GetCamCoord(cam)
                        local direction = RotationToDirection(GetCamRot(cam))
                        local spawnCoords = camCoords + direction * 5.0  -- Spawn vehicle 5 units in front of the camera
                        local vehicle = CreateVehicle(vehicleModel, spawnCoords.x, spawnCoords.y, spawnCoords.z, GetEntityHeading(playerPed), true, false)
                        
                        SetEntityAsMissionEntity(vehicle, true, true)

                        -- Apply force to the vehicle to move it towards the crosshair
                        local forceDirection = direction * 200.0  -- Adjust the force multiplier as needed
                        ApplyForceToEntity(vehicle, 1, forceDirection.x, forceDirection.y, forceDirection.z, 0, 0, 0, 0, false, true, true, false, true)
                        
                        SetModelAsNoLongerNeeded(vehicleModel)
                    end
                end
            end

            Citizen.Wait(0)
        end
    end)

    -- GodMode Thread
            Citizen.CreateThread(function()
                while true do
                    Wait(100)

                    if godModeEnabled then
                        local ped = PlayerPedId()

                        -- Forces invincibility consistently
                        SetEntityInvincible(ped, true)
                        SetEntityProofs(ped, true, true, true, true, true, true, true, true)

                        -- Infinite stamina
                        RestorePlayerStamina(PlayerId(), 1.0)

                        -- No ragdoll
                        SetPedCanRagdoll(ped, false)

                        -- Prevent drowning
                        SetPedDiesInWater(ped, false)
                        SetPedDiesInSinkingVehicle(ped, false)

                        -- Always full HP & Armor
                        if GetEntityHealth(ped) < 200 then
                            SetEntityHealth(ped, 200)
                        end
                        if GetPedArmour(ped) < 100 then
                            SetPedArmour(ped, 100)
                        end

                        -- If in vehicle  protect vehicle too
                        if IsPedInAnyVehicle(ped, false) then
                            local veh = GetVehiclePedIsIn(ped, false)
                            SetEntityInvincible(veh, true)
                            SetEntityProofs(veh, true, true, true, true, true, true, true, true)
                            SetVehicleTyresCanBurst(veh, false)
                            SetVehicleWheelsCanBreak(veh, false)
                        end
                    end
                end
            end)







            if GetResourceState("WaveShield") == 'started' then
                    MachoMenuNotification("Success", "WaveShield Anticheat Found.", 5000)
            elseif GetResourceState("ReaperV4") == 'started' then
                    MachoMenuNotification("Success", "ReaperV4 Anticheat Found.", 5000)
                elseif GetResourceState("ElectronAC") == 'started' then
                    MachoMenuNotification("Success", "ElectronAC Anticheat Found.", 5000)
                elseif GetResourceState("FiniAC") == 'started' then
                    MachoMenuNotification("Success", "FiniAC Anticheat Found.", 5000)
                end
