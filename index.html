<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menu DUI</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    :root { --red: #ff0000; --bg: rgba(0,0,0,0.85); --accent: rgba(100,0,0,0.6); }
    * { box-sizing: border-box; margin:0; padding:0; background: none; }
    html,body { height:100%; width:100%; font-family: "Segoe UI", Arial, sans-serif; -webkit-font-smoothing:antialiased; color:#fff; user-select:none; }

    .menu-wrapper {
      position: fixed;
      top: 50%;
      left: 6.5vh; 
      transform: translateY(-50%);
      width: 41vh;
      z-index: 9999;
      pointer-events: auto;
      transition: opacity .18s ease, left .28s ease;
      opacity: 1;
    }

    .banner-card { margin-left: 1.75vh; width: calc(100% - 1.75vh); border-radius: .4vh; overflow:hidden; line-height:0; }
    .banner-card img { display:block; width:100%; height:9.5vh; object-fit:cover; }

    .tabs {
      display:flex;
      background:#000;
      border-radius:.2vh;
      margin-top:-0.2vh;
      overflow:hidden;
    }
    .tab {
      flex:1;
      text-align:center;
      padding:1.5vh 1.2vh;
      font-size:1.15vh;
      font-weight:500;
      cursor:pointer;
      transition:all .12s ease;
      white-space:nowrap;
      color:#fff;
    }
    .tab.active { background: linear-gradient(0deg, var(--red) 0%, transparent 100%); }

    .menu-column {
      margin-left: 1.75vh;
      margin-top: 0.8vh;
      width: calc(100% - 1.75vh);
      background: var(--bg);
      border-radius: .3vh;
      padding: .3vh;
      display:flex;
      flex-direction: column;
      overflow: visible;
      position: relative;
    }

    .menu-list-wrap {
      max-height: 33.6vh;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .menu-list-wrap::-webkit-scrollbar { display:none; }

    .menu-list { display:flex; flex-direction:column; gap:0; padding: .3vh .4vh  .6vh .6vh; }

    .menu-item {
      padding: .7vh 1.0vh;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1vh;
      border-radius:.3vh;
      font-size:1.4vh;
      font-weight: 400;
      cursor:pointer;
      transition: background .12s ease, transform .06s ease;
      color: #fff;
    }
    .menu-item:hover { transform: translateX(.08vh); }
    .menu-item.active { background-color: rgba(100,0,0,0.6); border-left: .3vh solid var(--red); }

    .menu-divider {
      position:relative; display:flex; align-items:center; justify-content:center;
      height:2.2vh; margin:.6vh 0; pointer-events:none;
    }
    .menu-divider span { color: rgba(255,255,255,.75); font-size:1.0vh; font-weight:600; }
    .menu-divider::before, .menu-divider::after {
      content:""; position:absolute; top:50%; transform:translateY(-50%);
      width:7vh; height:.4vh; background: rgba(255,255,255,.95); border-radius:.2vh;
    }
    .menu-divider::before{ left:1.2vh } .menu-divider::after{ right:1.2vh }

    .toggle {
      width:3.3vh; height:1.5vh; border-radius:1vh; background:#222; position:relative; cursor:pointer;
    }
    .toggle::before {
      content:''; position:absolute; width:1.1vh; height:1.1vh; border-radius:50%; background:#fff; left:.2vh; top:.2vh; transition: transform .18s ease;
    }
    .toggle.on::before { transform: translateX(1.65vh); background:var(--red); }

    .range { width:7.5vh; height:1.2vh; background:transparent; -webkit-appearance:none; border:0; outline:none; }
    .range::-webkit-slider-runnable-track {
      height:.55vh; border-radius:.75vh;
      background: linear-gradient(to right, rgba(255,255,255,.95) 0 var(--pct), rgb(46,46,46) var(--pct) 100%);
    }
    .range::-webkit-slider-thumb { width:1.1vh; height:1.1vh; margin-top:-.3vh; border-radius:50%; background:#fff; -webkit-appearance:none; cursor:pointer; }

    .scroll-label { display:flex; align-items:center; gap:.4vh; min-width:8.5vh; justify-content:center; font-size:1.2vh; }

    .info-bar {
      margin-top:.6vh;
      margin-left: 1.75vh;
      width: calc(100% - 1.75vh);
      background: rgba(0,0,0,0.85);
      border-radius: .4vh;
      padding:.8vh .9vh;
      font-size:1.05vh;
      display:flex; justify-content:space-between; align-items:center;
      color:#fff;
    }

    .scrollbar-container {
      position: absolute;
      left: 0.5vh;
      width: 0.6vh;
      border-radius: .15vh;
      background: rgba(0,0,0,.45);
      pointer-events: none;
      z-index: 10;
      transition: height .18s ease, opacity .18s ease;
      overflow: hidden;
    }
    .scrollbar-container.hidden { opacity:0; display:none; }
    .scrollbar-thumb { position:absolute; left:0; right:0; top:0; height:1.2vh; background:var(--red); border-radius:.15vh; transition: top .08s linear, height .12s ease; }

    @media (max-width: 680px) {
      .menu-wrapper { left: 2vh; width: 78vw; transform: translateY(-50%); }
      .menu-column { width: 70vw; }
      .info-bar { width: 70vw; }
    }
  </style>
</head>
<body>
<div id="app">
  <div id="wrapper" class="menu-wrapper" aria-hidden="false">
    <div id="scrollbar" class="scrollbar-container hidden" style="top:0;height:0px;">
      <div id="thumb" class="scrollbar-thumb" style="top:0;height:24px;"></div>
    </div>

    <div class="banner-card">
      <img id="bannerImg" src="https://i.postimg.cc/cHwRL0V3/5a93bce4-705f-47cf-aa00-d818e2a97ee4.png" alt="banner" />
      <div id="tabs" class="tabs"></div>
    </div>

    <div class="menu-column" role="region" aria-label="menu-column">
      <div id="list-wrap" class="menu-list-wrap">
        <div id="list" class="menu-list"></div>
      </div>
    </div>

    <div id="info" class="info-bar">
      <span id="build">Beta 1.3 [Custom Build]</span>
      <span id="counter">(0/0)</span>
    </div>
  </div>
</div>

<script>
(function(){
let current=0, showing=true, activeTabs=["Main Menu"], currentTab=0;
let banner=document.getElementById('bannerImg').src;
let activeMenu=[{label:'Start Game',type:'button'},{label:'Enable Cheats',type:'checkbox',checked:false},{label:'Difficulty',type:'scroll',options:[{label:'Easy'},{label:'Normal'},{label:'Hard'},{label:'Extreme'}],selected:1},{label:'Volume',type:'slider',min:0,max:100,step:1,value:75},{label:'Settings',type:'submenu'},{label:'Separator',type:'divider'}];

const wrapper=document.getElementById('wrapper');
const listWrap=document.getElementById('list-wrap');
const listEl=document.getElementById('list');
const tabsEl=document.getElementById('tabs');
const bannerEl=document.getElementById('bannerImg');
const counterEl=document.getElementById('counter');
const scrollbar=document.getElementById('scrollbar');
const thumb=document.getElementById('thumb');

let itemEls=[], trackTop=0, trackHeight=0, thumbTop=0, thumbHeight=24;
let hasOverflow=false;
const MIN_THUMB=18, NO_OVERFLOW_THUMB_MAX=28;

function selectableMenu(){ return activeMenu.filter(o=>o?.type!=='divider'); }
function selectableIndices(){ return activeMenu.map((o,i)=>o?.type!=='divider'?i:-1).filter(i=>i!==-1); }

function counterCurrent(){
  const idxs=selectableIndices();
  if(idxs.length===0) return 0;
  const pos=idxs.indexOf(current);
  if(pos!==-1) return pos+1;
  let nearest=-1, best=Infinity;
  for(let i=0;i<idxs.length;i++){const d=Math.abs(idxs[i]-current); if(d<best){best=d; nearest=i;}}
  return nearest!==-1?nearest+1:0;
}

function renderTabs(){
  tabsEl.innerHTML='';
  if(!activeTabs||activeTabs.length===0) return;
  if(activeTabs.length===1){ const d=document.createElement('div'); d.className='tab active'; d.textContent=activeTabs[0]; tabsEl.appendChild(d); return; }
  activeTabs.forEach((t,i)=>{ const d=document.createElement('div'); d.className='tab'+(i===currentTab?' active':''); d.textContent=t; d.addEventListener('click',()=>{currentTab=i; renderTabs();}); tabsEl.appendChild(d); });
}

function createItem(option,i){
  if(option.type==='divider'){ const div=document.createElement('div'); div.className='menu-divider'; const span=document.createElement('span'); span.textContent=option.label||''; div.appendChild(span); return div; }
  const el=document.createElement('div'); el.className='menu-item'; el.dataset.index=i;
  if(i===current) el.classList.add('active');
  const left=document.createElement('span'); left.style.flexGrow='1'; left.style.textAlign='left'; left.style.fontSize='1.2vh'; left.textContent=option.label||''; el.appendChild(left);

  if(option.type==='submenu'){ const icon=document.createElement('i'); icon.className='ph ph-caret-right'; icon.style.fontSize='1.2vh'; el.appendChild(icon);}
  else if(option.type==='checkbox'){ const t=document.createElement('div'); t.className='toggle'+(option.checked?' on':''); t.addEventListener('click',(e)=>{e.stopPropagation(); option.checked=!option.checked; t.classList.toggle('on',!!option.checked); sendToHost({action:'changed', index:i, option});}); el.appendChild(t);}
  else if(option.type==='slider'){ const r=document.createElement('input'); r.type='range'; r.className='range'; r.min=option.min??0; r.max=option.max??100; r.step=option.step??1; r.value=option.value??r.min; r.style.setProperty('--pct',((r.value/(option.max||1))*100)+'%'); r.addEventListener('input',()=>{option.value=Number(r.value); r.style.setProperty('--pct',((r.value/(option.max||1))*100)+'%');}); r.addEventListener('change',()=>{sendToHost({action:'changed', index:i, option});}); el.appendChild(r);}
  else if(option.type==='scroll'){ const wrap=document.createElement('div'); wrap.className='scroll-label'; const l=document.createElement('span'); l.textContent='◀'; l.style.cursor='pointer'; const c=document.createElement('span'); c.textContent=(option.options&&option.options[option.selected]?.label)||''; c.style.minWidth='6vh'; const r=document.createElement('span'); r.textContent='▶'; r.style.cursor='pointer'; l.addEventListener('click',(e)=>{e.stopPropagation(); option.selected=Math.max(0,(option.selected||0)-1); renderMenu(); scheduleMeasure(); sendToHost({action:'changed', index:i, option});}); r.addEventListener('click',(e)=>{e.stopPropagation(); option.selected=Math.min((option.options?.length||1)-1,(option.selected||0)+1); renderMenu(); scheduleMeasure(); sendToHost({action:'changed', index:i, option});}); wrap.appendChild(l); wrap.appendChild(c); wrap.appendChild(r); el.appendChild(wrap);}
  else { const spacer=document.createElement('div'); spacer.style.width='1.2vh'; el.appendChild(spacer); }

  el.addEventListener('click',()=>{ current=i; renderMenu(); centerOnSelected(i); scheduleMeasure(); if(option.type==='button'||option.type==='submenu'){sendToHost({action:'activate', index:i, option});} });

  return el;
}

function renderMenu(){ listEl.innerHTML=''; itemEls=[]; activeMenu.forEach((opt,idx)=>{ const el=createItem(opt,idx); listEl.appendChild(el); itemEls[idx]=el; }); counterEl.textContent=`(${counterCurrent()}/${selectableMenu().length})`; renderTabs(); bannerEl.src=banner; requestAnimationFrame(measureScrollbar); }

function measureScrollbar(){
  if(!wrapper||!listWrap) return;
  const wrapperRect=wrapper.getBoundingClientRect();
  const listRect=listWrap.getBoundingClientRect();
  trackTop=Math.round(listRect.top-wrapperRect.top);
  trackHeight=Math.round(listRect.height);
  const clientH=listWrap.clientHeight;
  const scrollH=listEl.scrollHeight;
  hasOverflow=scrollH>clientH+1;
  thumbHeight=hasOverflow?Math.max(MIN_THUMB, Math.round((clientH/scrollH)*trackHeight)):Math.max(MIN_THUMB, Math.min(NO_OVERFLOW_THUMB_MAX, trackHeight));
  if(!showing||activeMenu.length===0) scrollbar.classList.add('hidden'); else { scrollbar.classList.remove('hidden'); scrollbar.style.top=trackTop+'px'; scrollbar.style.height=trackHeight+'px';}
  syncThumb();
}

function syncThumb(){
  const trackScrollable=Math.max(0, trackHeight-thumbHeight);
  if(hasOverflow){
    const maxScroll=Math.max(0,listEl.scrollHeight-listWrap.clientHeight);
    const ratio=maxScroll>0?Math.min(1,Math.max(0,listWrap.scrollTop/maxScroll)):0;
    thumbTop=Math.round(trackScrollable*ratio);
  } else { const count=Math.max(1,activeMenu.length); const lastIdx=Math.max(1,count-1); const idx=Math.min(Math.max(current,0),count-1); const ratio=count>1?(idx/lastIdx):0; thumbTop=Math.round(trackScrollable*ratio);}
  thumb.style.top=thumbTop+'px'; thumb.style.height=thumbHeight+'px';
}

function centerOnSelected(index){
  if(!listWrap) return;
  const maxScroll=Math.max(0,listEl.scrollHeight-listWrap.clientHeight);
  if(!hasOverflow||maxScroll===0){ listWrap.scrollTop=0; syncThumb(); return; }
  const lastIdx=Math.max(0,activeMenu.length-1);
  if(index<=0){listWrap.scrollTop=0; requestAnimationFrame(syncThumb); return;}
  if(index>=lastIdx){listWrap.scrollTop=maxScroll; requestAnimationFrame(syncThumb); return;}
  const item=itemEls[index]; if(!item) return;
  const itemTop=item.offsetTop;
  const itemCenter=itemTop+item.offsetHeight/2;
  let target=itemCenter-listWrap.clientHeight/2;
  if(target<0) target=0; if(target>maxScroll) target=maxScroll;
  listWrap.scrollTop=target; requestAnimationFrame(syncThumb);
}

listWrap.addEventListener('scroll',()=>syncThumb());
window.addEventListener('resize',()=>scheduleMeasure());
const scheduleMeasure=()=>requestAnimationFrame(()=>requestAnimationFrame(measureScrollbar));

function sendToHost(payload){try{window.postMessage(payload,'*');}catch(e){}}

window.addEventListener('message',(ev)=>{ const data=ev.data; if(!data||typeof data!=='object') return; const action=data.action; if(!action) return;
  if(action==='setCurrent'){ const incoming=data.current; current=(typeof incoming==='number')?Math.max(0,incoming-1):0; if(Array.isArray(data.menu)) activeMenu=data.menu; showing=data.visible!==undefined?!!data.visible:true; renderMenu(); centerOnSelected(current); scheduleMeasure();}
  else if(action==='setTabs'){ activeTabs=Array.isArray(data.tabs)?data.tabs:[]; currentTab=0; renderTabs();}
  else if(action==='setTabIndex'){ currentTab=(typeof data.index==='number')?data.index:0; renderTabs();}
  else if(action==='setVisible'){ showing=!!data.visible; wrapper.style.opacity=showing?'1':'0'; if(showing) centerOnSelected(current); scheduleMeasure();}
  else if(action==='position'){ const pos=data.position||'left'; if(pos==='left') wrapper.style.left='6.5vh'; else if(pos==='right') wrapper.style.left='calc(100% - 41vh)'; scheduleMeasure();}
  else if(action==='banner'){ if(typeof data.banner==='string'){ banner=data.banner; bannerEl.src=banner;}}
  else if(action==='setMenu'){ if(Array.isArray(data.menu)) activeMenu=data.menu; renderMenu(); scheduleMeasure();}
});

window.addEventListener('keydown',(e)=>{ if(!showing) return; const max=activeMenu.length-1;
  if(e.key==='ArrowDown'){ let idx=current; do{ idx=Math.min(idx+1,max); if(idx===current) break;}while(activeMenu[idx]?.type==='divider'); current=idx; renderMenu(); centerOnSelected(current); scheduleMeasure(); e.preventDefault();}
  else if(e.key==='ArrowUp'){ let idx=current; do{ idx=Math.max(idx-1,0); if(idx===current) break;}while(activeMenu[idx]?.type==='divider'); current=idx; renderMenu(); centerOnSelected(current); scheduleMeasure(); e.preventDefault();}
  else if(e.key==='Enter'){ const opt=activeMenu[current]; if(opt){ if(opt.type==='button'||opt.type==='submenu'){sendToHost({action:'activate', index:current, option:opt});} else if(opt.type==='checkbox'){ opt.checked=!opt.checked; renderMenu(); sendToHost({action:'changed', index:current, option:opt});} else if(opt.type==='scroll'){ opt.selected=Math.min((opt.options?.length||1)-1,(opt.selected||0)+1); renderMenu(); sendToHost({action:'changed', index:current, option:opt});}} e.preventDefault();}
  else if(e.key==='Escape'){ sendToHost({action:'escape'});}
});

renderMenu();
const ro=new ResizeObserver(()=>scheduleMeasure()); ro.observe(listEl); ro.observe(listWrap); ro.observe(wrapper);

window.__DUI_API__={ setMenu(m){if(Array.isArray(m)){ activeMenu=m; renderMenu(); scheduleMeasure();}}, setCurrent(i){ current=i; renderMenu(); centerOnSelected(i); scheduleMeasure();} };

scheduleMeasure();
})();
</script>
</body>
</html>
