<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>DUI Menu</title>
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
:root {
  --green:#00ff43;
  --accent:rgba(0,255,67,.55);
  --bg:rgba(0,0,0,.85);
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{
  width:100%;
  height:100%;
  font-family:Segoe UI,Arial,sans-serif;
  background:none;
  color:#fff;
  user-select:none;
}

.menu-wrapper{
  position:fixed;
  left:6.5vh;
  top:50%;
  transform:translateY(-50%);
  width:41vh;
}

.menu-column{
  background:var(--bg);
  border-radius:.4vh;
  padding:.4vh;
}

.menu-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:.7vh 1vh;
  font-size:1.25vh;
  border-radius:.3vh;
  cursor:pointer;
}

.menu-item.active{
  background:var(--accent);
  border-left:.3vh solid var(--green);
}

.toggle{
  width:3vh;
  height:1.4vh;
  background:#222;
  border-radius:1vh;
  position:relative;
}
.toggle::before{
  content:"";
  position:absolute;
  width:1vh;
  height:1vh;
  top:.2vh;
  left:.2vh;
  background:#fff;
  border-radius:50%;
  transition:.2s;
}
.toggle.on::before{
  transform:translateX(1.5vh);
  background:var(--green);
}

/* INPUT FIXES */
.inputbox{
  width:12vh;
  padding:.35vh .6vh;
  font-size:1.2vh;
  background:#222;
  border:1px solid var(--green);
  color:#fff;
  border-radius:.25vh;
  outline:none;
  user-select:text;
  pointer-events:auto;
}
.inputbox:focus{
  background:#111;
  border-color:var(--accent);
}
</style>
</head>

<body>
<div class="menu-wrapper">
  <div class="menu-column">
    <div id="list"></div>
  </div>
</div>

<script>
let activeMenu=[]
let current=0
let showing=true

const list=document.getElementById("list")

function sendToHost(d){
  window.postMessage(d,"*")
}

function render(){
  list.innerHTML=""
  activeMenu.forEach((o,i)=>{
    const el=document.createElement("div")
    el.className="menu-item"+(i===current?" active":"")
    el.onclick=()=>{current=i;render()}

    if(o.type==="checkbox"){
      el.innerHTML=`<span>${o.label}</span>`
      const t=document.createElement("div")
      t.className="toggle"+(o.checked?" on":"")
      t.onclick=e=>{
        e.stopPropagation()
        o.checked=!o.checked
        render()
        sendToHost({action:"changed",index:i,option:o})
      }
      el.appendChild(t)
    }

    else if(o.type==="inputbox"){
      const lbl=document.createElement("span")
      lbl.textContent=o.label
      el.appendChild(lbl)

      const input=document.createElement("input")
      input.className="inputbox"
      input.value=o.value||""

      input.addEventListener("focus",()=>{
        sendToHost({action:"typing",state:true})
      })

      input.addEventListener("blur",()=>{
        sendToHost({action:"typing",state:false})
        o.value=input.value
        sendToHost({action:"setInputValue",index:i,value:o.value})
      })

      input.addEventListener("keydown",e=>{
        e.stopPropagation()
        if(e.key==="Enter") input.blur()
        if(e.key==="Escape"){
          input.value=o.value||""
          input.blur()
        }
      })

      el.appendChild(input)
    }

    else{
      el.innerHTML=`<span>${o.label}</span>`
    }

    list.appendChild(el)
  })
}

window.addEventListener("message",e=>{
  const d=e.data
  if(!d||!d.action) return

  if(d.action==="setMenu"){
    activeMenu=d.menu||[]
    current=(d.current||1)-1
    render()
  }
})
</script>
</body>
</html>
