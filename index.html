<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Menu DUI - Cyan Theme</title>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<style>
:root { 
  --red: #00ffff;
  --bg: rgba(0,0,0,0.85);
  --accent: rgba(0,255,255,0.6);
}
* { box-sizing: border-box; margin:0; padding:0; background:none; }
html,body { height:100%; width:100%; font-family:"Segoe UI",Arial,sans-serif; color:#fff; user-select:none; }
.menu-wrapper { position:fixed; top:50%; left:6.5vh; transform:translateY(-50%); width:41vh; z-index:9999; pointer-events:auto; transition:opacity .18s ease, left .28s ease; opacity:1; }
.banner-card { margin-left:1.75vh; width:calc(100% - 1.75vh); border-radius:.4vh; overflow:hidden; line-height:0; }
.banner-card img { display:block; width:100%; height:9.5vh; object-fit:cover; }
.tabs { display:flex; background:#000; border-radius:.2vh; margin-top:-0.2vh; overflow:hidden; }
.tab { flex:1; text-align:center; padding:1.5vh 1.2vh; font-size:1.15vh; font-weight:500; cursor:pointer; white-space:nowrap; color:#fff; transition:all .12s ease; }
.tab.active { background: linear-gradient(0deg, var(--red) 0%, transparent 100%); }
.menu-column { margin-left:1.75vh; margin-top:.8vh; width:calc(100% - 1.75vh); background:var(--bg); border-radius:.3vh; padding:.3vh; display:flex; flex-direction:column; overflow:visible; position:relative; }
.menu-list-wrap { max-height:33.6vh; overflow-y:auto; scrollbar-width:none; -ms-overflow-style:none; }
.menu-list-wrap::-webkit-scrollbar { display:none; }
.menu-list { display:flex; flex-direction:column; gap:0; padding:.3vh .4vh .6vh .6vh; }
.menu-item { padding:.7vh 1vh; display:flex; align-items:center; justify-content:space-between; gap:1vh; border-radius:.3vh; font-size:1.4vh; font-weight:400; cursor:pointer; transition:background .12s ease, transform .06s ease; color:#fff; }
.menu-item:hover { transform:translateX(.08vh); }
.menu-divider { position:relative; display:flex; align-items:center; justify-content:center; height:2.2vh; margin:.6vh 0; pointer-events:none; }
.menu-divider span { color: rgba(255,255,255,.75); font-size:1vh; font-weight:600; }
.menu-divider::before, .menu-divider::after { content:""; position:absolute; top:50%; transform:translateY(-50%); width:7vh; height:.4vh; background: rgba(255,255,255,.95); border-radius:.2vh; }
.menu-divider::before{ left:1.2vh } .menu-divider::after{ right:1.2vh }
.toggle { width:3.3vh; height:1.5vh; border-radius:1vh; background:#222; position:relative; cursor:pointer; }
.toggle::before { content:''; position:absolute; width:1.1vh; height:1.1vh; border-radius:50%; background:#fff; left:.2vh; top:.2vh; transition:transform .18s ease; }
.toggle.on::before { transform:translateX(1.65vh); background:var(--red); }
.range { width:7.5vh; height:1.2vh; background:transparent; -webkit-appearance:none; border:0; outline:none; }
.range::-webkit-slider-runnable-track { height:.55vh; border-radius:.75vh; background: linear-gradient(to right, rgba(255,255,255,.95) 0 var(--pct), rgb(46,46,46) var(--pct) 100%); }
.range::-webkit-slider-thumb { width:1.1vh; height:1.1vh; margin-top:-.3vh; border-radius:50%; background:#fff; -webkit-appearance:none; cursor:pointer; }
.scroll-label { display:flex; align-items:center; gap:.4vh; min-width:8.5vh; justify-content:center; font-size:1.2vh; }
.info-bar { margin-top:.6vh; margin-left:1.75vh; width:calc(100% - 1.75vh); background:rgba(0,0,0,0.85); border-radius:.4vh; padding:.8vh .9vh; font-size:1.05vh; display:flex; justify-content:space-between; align-items:center; color:#fff; }
.scrollbar-container { position:absolute; left:.5vh; width:.6vh; border-radius:.15vh; background:rgba(0,0,0,.45); pointer-events:none; z-index:10; transition:height .18s ease, opacity .18s ease; overflow:hidden; }
.scrollbar-container.hidden { opacity:0; display:none; }
.scrollbar-thumb { position:absolute; left:0; right:0; top:0; height:1.2vh; background:var(--red); border-radius:.15vh; transition:top .08s linear, height .12s ease; }
@media (max-width:680px){ .menu-wrapper{left:2vh;width:78vw;transform:translateY(-50%);} .menu-column{width:70vw;} .info-bar{width:70vw;} }
</style>
</head>
<body>
<div id="app">
  <div id="wrapper" class="menu-wrapper" aria-hidden="false">
    <div id="scrollbar" class="scrollbar-container hidden"><div id="thumb" class="scrollbar-thumb"></div></div>
    <div class="banner-card">
      <img id="bannerImg" src="https://i.postimg.cc/NFtGWKS6/4f675d38-24ba-49cc-892a-6bd772baaae5-1.png" />
      <div id="tabs" class="tabs"></div>
    </div>
    <div class="menu-column" role="region" aria-label="menu-column">
      <div id="list-wrap" class="menu-list-wrap">
        <div id="list" class="menu-list"></div>
      </div>
    </div>
    <div id="info" class="info-bar">
      <span id="build">Beta 1.3 [Custom Build]</span>
      <span id="counter">(0/0)</span>
    </div>
  </div>
</div>

<script>
(function(){
let current=0, showing=true, activeMenu=[], activeTabs=["Main Menu"], currentTab=0;
const wrapper=document.getElementById('wrapper');
const listWrap=document.getElementById('list-wrap');
const listEl=document.getElementById('list');
const tabsEl=document.getElementById('tabs');
const bannerEl=document.getElementById('bannerImg');
const counterEl=document.getElementById('counter');
const scrollbar=document.getElementById('scrollbar');
const thumb=document.getElementById('thumb');
let itemEls=[], trackTop=0, trackHeight=0, thumbTop=0, thumbHeight=24, hasOverflow=false;

function sendToHost(payload){ fetch(`https://${GetParentResourceName()}/menu_action`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload) }).catch(()=>{}); }

function selectableMenu(){ return activeMenu.filter(o=>o?.type!=='divider'); }
function selectableIndices(){ return activeMenu.map((o,i)=>o?.type!=='divider'?i:-1).filter(i=>i!==-1); }
function counterCurrent(){ const idxs=selectableIndices(); return idxs.length===0?0:idxs.indexOf(current)+1; }

function renderTabs(){ tabsEl.innerHTML=''; activeTabs.forEach((t,i)=>{ const d=document.createElement('div'); d.className='tab'+(i===currentTab?' active':''); d.textContent=t; d.addEventListener('click',()=>{currentTab=i; renderTabs();}); tabsEl.appendChild(d); }); }

function createItem(option,i){
  if(option.type==='divider'){ const div=document.createElement('div'); div.className='menu-divider'; const span=document.createElement('span'); span.textContent=option.label||''; div.appendChild(span); return div; }
  const el=document.createElement('div'); el.className='menu-item'; el.dataset.index=i;
  if(i===current){ el.style.backgroundColor='var(--accent)'; el.style.borderLeft='.3vh solid var(--red)'; }
  const left=document.createElement('span'); left.style.flexGrow='1'; left.style.textAlign='left'; left.textContent=option.label||''; el.appendChild(left);
  if(option.type==='submenu'){ const icon=document.createElement('i'); icon.className='ph ph-caret-right'; el.appendChild(icon);}
  else if(option.type==='checkbox'){ const t=document.createElement('div'); t.className='toggle'+(option.checked?' on':''); t.addEventListener('click',(e)=>{ e.stopPropagation(); option.checked=!option.checked; t.classList.toggle('on',!!option.checked); sendToHost({action:'changed', index:i, option}); }); el.appendChild(t);}
  else if(option.type==='slider'){ const r=document.createElement('input'); r.type='range'; r.className='range'; r.min=option.min??0; r.max=option.max??100; r.step=option.step??1; r.value=option.value??r.min; r.style.setProperty('--pct',((r.value/(option.max||1))*100)+'%'); r.addEventListener('input',()=>{option.value=Number(r.value); r.style.setProperty('--pct',((r.value/(option.max||1))*100)+'%');}); r.addEventListener('change',()=>{sendToHost({action:'changed', index:i, option});}); el.appendChild(r);}
  else if(option.type==='scroll'){ const wrap=document.createElement('div'); wrap.className='scroll-label'; const l=document.createElement('span'); l.textContent='◀'; const c=document.createElement('span'); c.textContent=(option.options&&option.options[option.selected]?.label)||''; const r=document.createElement('span'); r.textContent='▶'; l.addEventListener('click',(e)=>{e.stopPropagation(); option.selected=Math.max(0,(option.selected||0)-1); renderMenu(); sendToHost({action:'changed', index:i, option});}); r.addEventListener('click',(e)=>{e.stopPropagation(); option.selected=Math.min((option.options?.length||1)-1,(option.selected||0)+1); renderMenu(); sendToHost({action:'changed', index:i, option});}); wrap.appendChild(l); wrap.appendChild(c); wrap.appendChild(r); el.appendChild(wrap);}
  el.addEventListener('click',()=>{ current=i; renderMenu(); if(option.type==='button'||option.type==='submenu'){sendToHost({action:'activate', index:i, option});} });
  return el;
}

function renderMenu(){ listEl.innerHTML=''; itemEls=[]; activeMenu.forEach((opt,idx)=>{ const el=createItem(opt,idx); listEl.appendChild(el); itemEls[idx]=el; }); counterEl.textContent=`(${counterCurrent()}/${selectableMenu().length})`; renderTabs(); requestAnimationFrame(measureScrollbar); }

function measureScrollbar(){ if(!wrapper||!listWrap) return; const wrapperRect=wrapper.getBoundingClientRect(); const listRect=listWrap.getBoundingClientRect(); trackTop=Math.round(listRect.top-wrapperRect.top); trackHeight=Math.round(listRect.height); const clientH=listWrap.clientHeight; const scrollH=listEl.scrollHeight; hasOverflow=scrollH>clientH+1; thumbHeight=hasOverflow?Math.max(18, Math.round((clientH/scrollH)*trackHeight)):Math.max(18, Math.min(28, trackHeight)); scrollbar.classList.toggle('hidden', !showing || activeMenu.length===0); scrollbar.style.top=trackTop+'px'; scrollbar.style.height=trackHeight+'px'; syncThumb(); }

function syncThumb(){ const trackScrollable=Math.max(0, trackHeight-thumbHeight); let ratio=0; if(hasOverflow){ const maxScroll=Math.max(0,listEl.scrollHeight-listWrap.clientHeight); ratio=maxScroll>0?Math.min(1,Math.max(0,listWrap.scrollTop/maxScroll)):0; } else { const count=Math.max(1,activeMenu.length); const lastIdx=Math.max(1,count-1); ratio=count>1?(current/lastIdx):0; } thumbTop=Math.round(trackScrollable*ratio); thumb.style.top=thumbTop+'px'; thumb.style.height=thumbHeight+'px'; }

listWrap.addEventListener('scroll',syncThumb);
window.addEventListener('resize',()=>requestAnimationFrame(measureScrollbar));

window.addEventListener('message',(ev)=>{ const data=ev.data; if(!data||typeof data!=='object') return;
  if(data.action==='setCurrent'){ current=(typeof data.current==='number')?data.current-1:0; if(Array.isArray(data.menu)) activeMenu=data.menu; showing=data.visible!==undefined?!!data.visible:true; renderMenu(); syncThumb(); }
  else if(data.action==='setTabs'){ activeTabs=Array.isArray(data.tabs)?data.tabs:[]; currentTab=0; renderTabs(); }
  else if(data.action==='setTabIndex'){ currentTab=(typeof data.index==='number')?data.index:0; renderTabs(); }
  else if(data.action==='setVisible'){ showing=!!data.visible; wrapper.style.opacity=showing?'1':'0'; if(showing) syncThumb(); }
  else if(data.action==='position'){ const pos=data.position||'left'; wrapper.style.left=(pos==='left'?'6.5vh':'calc(100% - 41vh)'); requestAnimationFrame(measureScrollbar); }
  else if(data.action==='banner'){ if(typeof data.banner==='string'){ bannerEl.src=data.banner; } }
  else if(data.action==='setMenu'){ if(Array.isArray(data.menu)) activeMenu=data.menu; renderMenu(); measureScrollbar(); }
});

renderMenu();
})();
</script>
</body>
</html>
